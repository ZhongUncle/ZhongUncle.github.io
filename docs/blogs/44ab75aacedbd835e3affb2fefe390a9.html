<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='en'>
        <title>使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="最近想树莓派 Pico、DHT11 温湿度传感器和 SSD1306 OLED 屏幕做一个温度湿度计，树莓派官方案例也分别有这两个设备的案例，我就想做个简单的温度湿度计作为学习微控制器的开始，结果遇到了一个大坑，所以写本文记录一下整个过程。" />
<meta property="og:description" content="最近想树莓派 Pico、DHT11 温湿度传感器和 SSD1306 OLED 屏幕做一个温度湿度计，树莓派官方案例也分别有这两个设备的案例，我就想做个简单的温度湿度计作为学习微控制器的开始，结果遇到了一个大坑，所以写本文记录一下整个过程。" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/44ab75aacedbd835e3affb2fefe390a9.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/44ab75aacedbd835e3affb2fefe390a9.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-28T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-28T00:00:00+08:00","datePublished":"2023-08-28T00:00:00+08:00","description":"最近想树莓派 Pico、DHT11 温湿度传感器和 SSD1306 OLED 屏幕做一个温度湿度计，树莓派官方案例也分别有这两个设备的案例，我就想做个简单的温度湿度计作为学习微控制器的开始，结果遇到了一个大坑，所以写本文记录一下整个过程。","headline":"使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/44ab75aacedbd835e3affb2fefe390a9.html"},"url":"https://zhonguncle.github.io/blogs/44ab75aacedbd835e3affb2fefe390a9.html"}</script>
<!-- End Jekyll SEO tag -->

        
        <!-- Microsoft Clarity -->
        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "ix8xlal10a");
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS87H0FDV7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SS87H0FDV7');
        </script>
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/mcu.html" class="headerItem">
            MCU
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>使用树莓派Pico、DHT11和SSD1306搭建一个温度湿度计（只使用官方库，以及官方案例代码的错误之处和解决方案）</h1>
            <div class="bloginfo">
                <p class="info">2023-08-28 ｜ <a href="/mcu.html"> MCU</a> ｜ #Words: 10552 </p>
            </div>
            <!-- excerpt-start -->
<p>最近想树莓派 Pico、DHT11 温湿度传感器和 SSD1306 OLED 屏幕做一个温度湿度计，树莓派官方案例也分别有这两个设备的案例，我就想做个简单的温度湿度计作为学习微控制器的开始，结果遇到了一个大坑，所以写本文记录一下整个过程。</p>

<p>本文最后会实现一个能在 SSD1306 OLED 屏幕上显示当前环境的温度和湿度，并且还要通过 USB 输出这些信息。</p>

<p><strong>由于本文很长，建议通过侧边栏方便阅读。</strong></p>

<p>本文的完整代码我放到了<a href="https://github.com/ZhongUncle/pico-temp-hum-oled">GitHub-ZhongUncle/pico-temp-hum-oled</a>，并且在<code class="language-plaintext highlighter-rouge">build</code>目录下放了编译好的内容，方便读者进行尝试。</p>

<h2 id="开发工具和环境准备">开发工具和环境准备</h2>
<p>需要安装<code class="language-plaintext highlighter-rouge">pico-sdk</code>和配置相关环境变量。这部分请参阅我的另外一篇博客<a href="/blogs/5e449fdb610b2a4d7ee8ee742fbfe736.html">《如何使用Mac终端给树莓派pico构建C/C++程序进行开发，以及遇到各种问题该怎么处理，不使用任何IDE或编辑器（例如VS Code）》</a>，这里就不再赘述了。</p>
<h2 id="准备材料">准备材料</h2>
<p>实现这个需要以下材料：</p>
<ul>
  <li>树莓派 Pico 或 Pico W；</li>
  <li>SSD1306 OLED屏幕；</li>
  <li>DHT11 温湿度传感器；</li>
  <li>导线若干；</li>
  <li>面包板；</li>
  <li>面包板电源（可选，因为传感器和屏幕的供电 Pico 就可以满足）。</li>
</ul>

<p>DHT11 的针脚有 3 针和 4 针两种：</p>

<p><img alt="" src="/assets/images/3079eef6fd384391a6ba3349fd3ee1bd.jpeg" height="200px" /></p>

<p>如果是 4 针的，那么不连接针脚 3：</p>

<p><img alt="" src="/assets/images/2f883839ec814d74a017ecc0d3e75c88.jpeg" height="200px" /></p>

<p>如果你看过官方文档或者其他一些教程，那么你会看到还需要一个电阻（10k 或 4.7k 欧姆）来拉取（pull up）数据线，但是这个电阻实际上不影响官方代码不能运行，实际正常运行也不需要，所以有没有这个电阻都可以。</p>

<h2 id="连线">连线</h2>
<p>Pico 的针脚图如下：</p>

<p><img src="/assets/images/1fa9d6e58bca4d9ba3483fbf7417f3dd.png" alt="请添加图片描述" /></p>

<p>整个电路的电源通过 Pico 实现，使用 Pin 38 作为地线，Pin 36 作为电源线，3.3V 满足这两个传感器的需求。一般传感器上都标有电源和地线标识，所以这两种按照标识连接即可。</p>

<p>SSD1306 的<code class="language-plaintext highlighter-rouge">SCL</code>连接到 Pin 7，而<code class="language-plaintext highlighter-rouge">SDA</code>连接到 Pin 6。选择这两个针脚是因为这是 Pico 默认的 I2C 协议接口，而 SSD 1306 是按照 I2C 协议通信的。你也可以根据情况修改针脚，但本文并没有修改默认针脚。</p>

<p>修改默认针脚或者指定其他针脚方法可以看看我的这两篇博客，第一篇适合任何情况，比较通用，第二篇更适合只有一个 I2C 外围设备的情况：</p>

<ul>
  <li><a href="/blogs/5f1a7fd5d52116befdae2e8e54b10888.html">《Pico如何使用C/C++选择使用哪个I2C控制器，以及SDA和SCL针脚》</a></li>
  <li><a href="/blogs/911891686f4a77e37082c2b4210451c9.html">《用C/C++修改I2C默认的SDA和SCL针脚》</a></li>
</ul>

<blockquote>
  <p>如果你对 I2C 不了解，那么可以看看这篇介绍：<a href="https://www.circuitbasics.com/basics-of-the-i2c-communication-protocol/">BASICS OF THE I2C COMMUNICATION PROTOCOL</a></p>
</blockquote>

<p>DHT11 的<code class="language-plaintext highlighter-rouge">data</code>针脚可以连接到 Pico 的任意 GP 针脚，推荐 GP15 或 GP16，因为这两个一般在面包板上离传感器近，需要的导线比较短。</p>

<p>连接出来效果如下：</p>

<p><img src="/assets/images/4587d3df85af421497617e2442adc8ee.jpeg" alt="请添加图片描述" /></p>

<h2 id="项目结构">项目结构</h2>
<p><strong>本文中实现的项目我放到了 GitHub 上，你可以弄到本地看看效果。</strong></p>

<p>新建一个文件夹<code class="language-plaintext highlighter-rouge">pico-temp-hum</code>，在里面新建 3 个文件<code class="language-plaintext highlighter-rouge">font.h</code>、<code class="language-plaintext highlighter-rouge">pico-temp-hum.c</code>、<code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>和一个空白目录<code class="language-plaintext highlighter-rouge">build</code>，再将<code class="language-plaintext highlighter-rouge">pico-sdk</code>里的<code class="language-plaintext highlighter-rouge">pico_sdk_import.cmake</code>文件复制到这里。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ mkdir pico-temp-hum
$ cd pico-temp-hum
$ touch font.h pico-temp-hum.c CMakeLists.txt
$ mkdir build
$ cp ../pico-sdk/pico_sdk_init.cmake pico_sdk_init.cmake
</code></pre></div></div>

<p>这时候项目结构看起来如下：</p>

<p><img alt="" src="/assets/images/bcbca1ea28e24d62934dc7fb166aad8f.png" style="box-shadow: 0px 0px 0px 0px" /></p>

<p>接下来就可以写代码了。</p>
<h2 id="代码">代码</h2>
<h3 id="fonth"><code class="language-plaintext highlighter-rouge">font.h</code></h3>
<p>首先是<code class="language-plaintext highlighter-rouge">font.h</code>文件，这里是存放字体信息的文件。</p>

<p>SSD1306 有两种版本：128x32 和 128x64，像素纵向按 8 行划分为多页（page）。比如上图中的 128x64 版本在 RAM 是下面这样排列的：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       | COL0 | COL1 | COL2 | COL3 |  ...  | COL126 | COL127 |
PAGE 0 |      |      |      |      |       |        |        |
PAGE 1 |      |      |      |      |       |        |        |
PAGE 2 |      |      |      |      |       |        |        |
PAGE 3 |      |      |      |      |       |        |        |
PAGE 4 |      |      |      |      |       |        |        |
PAGE 5 |      |      |      |      |       |        |        |
PAGE 6 |      |      |      |      |       |        |        |
PAGE 7 |      |      |      |      |       |        |        |
--------------------------------------------------------------
</code></pre></div></div>

<p>在每个页内部如下（也就是按行和列确定像素）：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      | COL0 | COL1 | COL2 | COL3 |  ...  | COL126 | COL127 |
COM 0 |      |      |      |      |       |        |        |
COM 1 |      |      |      |      |       |        |        |
:     |      |      |      |      |       |        |        |
COM 7 |      |      |      |      |       |        |        |
-------------------------------------------------------------
</code></pre></div></div>

<p>所以使用高度为 8 的字体比较好。这里我们使用 MicroPython 项目的字体，这种字体是 8x8
 格式的，宽度和高度非常适合 SSD1306，因为 128 刚好是 8 的倍数。</p>

<p>在<code class="language-plaintext highlighter-rouge">font.h</code>中输入以下内容（毕竟这字体不是自己做的，还是不要删注释吧）：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * This file is part of the MicroPython project, http://micropython.org/
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2013, 2014 Damien P. George
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */</span>
<span class="cp">#ifndef MICROPY_INCLUDED_STM32_FONT_PETME128_8X8_H
#define MICROPY_INCLUDED_STM32_FONT_PETME128_8X8_H
</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">uint8_t</span> <span class="n">font</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 32=</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 33=!</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 34="</span>
    <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="c1">// 35=#</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 36=$</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 37=%</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="c1">// 38=&amp;</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 39='</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 40=(</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 41=)</span>
    <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="c1">// 42=*</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 43=+</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 44=,</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 45=-</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 46=.</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="c1">// 47=/</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 48=0</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 49=1</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 50=2</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 51=3</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="c1">// 52=4</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 53=5</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 54=6</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 55=7</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 56=8</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 57=9</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 58=:</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 59=;</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 60=&lt;</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 61==</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 62=&gt;</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 63=?</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 64=@</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 65=A</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 66=B</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 67=C</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 68=D</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 69=E</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 70=F</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 71=G</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 72=H</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 73=I</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 74=J</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 75=K</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 76=L</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="c1">// 77=M</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 78=N</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 79=O</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 80=P</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 81=Q</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 82=R</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 83=S</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 84=T</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 85=U</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 86=V</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="c1">// 87=W</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 88=X</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 89=Y</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 90=Z</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 91=[</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="c1">// 92='\'</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 93=]</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 94=^</span>
    <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="c1">// 95=_</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 96=`</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 97=a</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 98=b</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 99=c</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 100=d</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 101=e</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 102=f</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 103=g</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 104=h</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 105=i</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 106=j</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 107=k</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 108=l</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="c1">// 109=m</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 110=n</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 111=o</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 112=p</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 113=q</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 114=r</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 115=s</span>
    <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 116=t</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 117=u</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 118=v</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="c1">// 119=w</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 120=x</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 121=y</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 122=z</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 123={</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 124=|</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="c1">// 125=}</span>
    <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="c1">// 126=~</span>
    <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="c1">// 127</span>
<span class="p">};</span>

<span class="cp">#endif // MICROPY_INCLUDED_STM32_FONT_PETME128_8X8_H
</span></code></pre></div></div>

<blockquote>
  <p>我在参考 Mac OS 3.2 的系统字体创作字体，这种字体很好看，也是位图字体。我在实现了一些字母发现确实要比一些常见的字体好看的多，但是实现难度不小。因为这种字体的宽度和高度并不是 8 或 8 的倍数，所以需要做一些调整。如果搞定了，那么会替换上面和 GitHub 项目里的内容。</p>
</blockquote>

<h3 id="pico-temp-humc"><code class="language-plaintext highlighter-rouge">pico-temp-hum.c</code></h3>
<h4 id="头文件">头文件</h4>
<p>首先是添加头文件：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;ctype.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp">
#include</span> <span class="cpf">"pico/stdlib.h"</span><span class="cp">
#include</span> <span class="cpf">"hardware/i2c.h"</span><span class="cp">
#include</span> <span class="cpf">"hardware/gpio.h"</span><span class="cp">
#include</span> <span class="cpf">"ssd1306_font.h"</span><span class="cp">
</span></code></pre></div></div>

<h4 id="ssd1306相关代码">SSD1306相关代码</h4>
<p>然后是添加一堆后面可能会使用到的宏，主要是 SSD1306 的命令。介绍还请看注释：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//根据你SSD1306的规格设置SSD1306_HEIGHT为32或64</span>
<span class="cp">#define SSD1306_HEIGHT              64
#define SSD1306_WIDTH               128
</span>
<span class="cp">#define SSD1306_I2C_ADDR            _u(0x3C)
</span>
<span class="c1">//SSD1306时钟速率，一般是400000（40MHz），但是会有频闪现象，为了减缓频闪和提升响应速度，建议使用1000000（100MHz）</span>
<span class="cp">#define SSD1306_I2C_CLK             1000000
</span>
<span class="c1">//SSD1306的命令（更多可以参阅SSD1306数据表 https://www.digikey.com/htmldatasheets/production/2047793/0/0/1/ssd1306.html）</span>
<span class="cp">#define SSD1306_SET_MEM_MODE        _u(0x20)
#define SSD1306_SET_COL_ADDR        _u(0x21)
#define SSD1306_SET_PAGE_ADDR       _u(0x22)
#define SSD1306_SET_HORIZ_SCROLL    _u(0x26)
#define SSD1306_SET_SCROLL          _u(0x2E)
</span>
<span class="cp">#define SSD1306_SET_DISP_START_LINE _u(0x40)
</span>
<span class="cp">#define SSD1306_SET_CONTRAST        _u(0x81)
#define SSD1306_SET_CHARGE_PUMP     _u(0x8D)
</span>
<span class="cp">#define SSD1306_SET_SEG_REMAP       _u(0xA0)
#define SSD1306_SET_ENTIRE_ON       _u(0xA4)
#define SSD1306_SET_ALL_ON          _u(0xA5)
#define SSD1306_SET_NORM_DISP       _u(0xA6)
#define SSD1306_SET_INV_DISP        _u(0xA7)
#define SSD1306_SET_MUX_RATIO       _u(0xA8)
#define SSD1306_SET_DISP            _u(0xAE)
#define SSD1306_SET_COM_OUT_DIR     _u(0xC0)
#define SSD1306_SET_COM_OUT_DIR_FLIP _u(0xC0)
</span>
<span class="cp">#define SSD1306_SET_DISP_OFFSET     _u(0xD3)
#define SSD1306_SET_DISP_CLK_DIV    _u(0xD5)
#define SSD1306_SET_PRECHARGE       _u(0xD9)
#define SSD1306_SET_COM_PIN_CFG     _u(0xDA)
#define SSD1306_SET_VCOM_DESEL      _u(0xDB)
</span>
<span class="c1">//页高</span>
<span class="cp">#define SSD1306_PAGE_HEIGHT         _u(8)
</span><span class="c1">//页的数量</span>
<span class="cp">#define SSD1306_NUM_PAGES           (SSD1306_HEIGHT / SSD1306_PAGE_HEIGHT)
</span><span class="c1">//页面内容的缓冲区域，这部分内容在渲染之后会显示到屏幕上</span>
<span class="cp">#define SSD1306_BUF_LEN             (SSD1306_NUM_PAGES * SSD1306_WIDTH)
</span>
<span class="cp">#define SSD1306_WRITE_MODE         _u(0xFE)
#define SSD1306_READ_MODE          _u(0xFF)
</span></code></pre></div></div>

<p>然后添加一个结构体，用来存放渲染区域的数据，包括起始列、起始页，这样我们既可以渲染整个屏幕，也可以只渲染一部分：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">struct</span> <span class="n">render_area</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">start_col</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">end_col</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">start_page</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">end_page</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">buflen</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>然后添加一个函数用来计算渲染区域的长度，将值赋予给上面结构体对象的<code class="language-plaintext highlighter-rouge">buflen</code>变量。因为我们可能需要清零渲染屏幕的缓冲，这个需要知道渲染区域的长度，不然会导致一些内容没有被清理或者覆盖掉，具体情况后面会提及：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">calc_render_area_buflen</span><span class="p">(</span><span class="k">struct</span> <span class="n">render_area</span> <span class="o">*</span><span class="n">area</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//计算渲染区域的长度</span>
    <span class="n">area</span><span class="o">-&gt;</span><span class="n">buflen</span> <span class="o">=</span> <span class="p">(</span><span class="n">area</span><span class="o">-&gt;</span><span class="n">end_col</span> <span class="o">-</span> <span class="n">area</span><span class="o">-&gt;</span><span class="n">start_col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">area</span><span class="o">-&gt;</span><span class="n">end_page</span> <span class="o">-</span> <span class="n">area</span><span class="o">-&gt;</span><span class="n">start_page</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>接下来是 SSD1306 命令相关的代码，SSD1306 的支持一系列的命令来操作屏幕，命令具体情况请查看数据表：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">SSD1306_send_cmd</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// I2C write process expects a control byte followed by data</span>
    <span class="c1">// this "data" can be a command or data to follow up a command</span>
    <span class="c1">// Co = 1, D/C = 0 =&gt; the driver expects a command（控制为1，数据或命令为0）</span>
    <span class="c1">//I2C写入进程需要一个控制字节和数据。数据可以也是一个命令或者跟着命令的数据。比如说</span>
    <span class="kt">uint8_t</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">cmd</span><span class="p">};</span>
    <span class="c1">//第一个参数表示用的哪个i2c控制器，i2c0或i2c1。这里默认为i2c0</span>
    <span class="c1">//第二个参数是要读取的设备的7位地址。这个前面定义宏的时候设置了，为0x3C</span>
    <span class="c1">//第三个参数是指向接收数据的缓冲的指针。你可能会疑问上面不是数组吗？C里面数组名其实就是指针）</span>
    <span class="c1">//第四个参数是接收数据的长度（单位为字节）。这里就为2</span>
    <span class="c1">//第五个参数如果是真，那么主机在交换数据之后保持对bus的控制。这里为false</span>
    <span class="n">i2c_write_blocking</span><span class="p">(</span><span class="n">i2c_default</span><span class="p">,</span> <span class="n">SSD1306_I2C_ADDR</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">SSD1306_send_cmd_list</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">num</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="n">SSD1306_send_cmd</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">SSD1306_send_buf</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">buf</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">buflen</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//水平地址模式下，列地址指针自动增加并且包括下一个页，所以可以一个交换就可以发送包含整个帧的缓冲</span>
	<span class="c1">//复制帧缓冲到一个新的缓冲中是为了在开始添加一个控制字节</span>
    <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">temp_buf</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">buflen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

    <span class="n">temp_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">temp_buf</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">buflen</span><span class="p">);</span>

    <span class="n">i2c_write_blocking</span><span class="p">(</span><span class="n">i2c_default</span><span class="p">,</span> <span class="n">SSD1306_I2C_ADDR</span><span class="p">,</span> <span class="n">temp_buf</span><span class="p">,</span> <span class="n">buflen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">temp_buf</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>然后编写 SSD1306 的初始化函数。需要注意<code class="language-plaintext highlighter-rouge">cmds[]</code>里的命令都是上面宏区域定义过的，有些后面会跟着需要设置的值，但是有些命令是自身决定设置值的。这只是个简单的数组，并不是什么特殊的数据结构：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">SSD1306_init</span><span class="p">()</span> <span class="p">{</span>
    <span class="cm">/* 这里是重置进程为默认情况的完整流程，但是不同厂商的可能不一样 */</span>
    <span class="kt">uint8_t</span> <span class="n">cmds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">SSD1306_SET_DISP</span><span class="p">,</span>               <span class="c1">//关闭显示器</span>
        <span class="cm">/* 内存映射 */</span>
        <span class="n">SSD1306_SET_MEM_MODE</span><span class="p">,</span>           <span class="c1">//设置内存地址模式。0为横向地址模式，1为纵向地址模式，2为页地址模式</span>
        <span class="mh">0x00</span><span class="p">,</span>                           <span class="c1">//设置为横向寻址模式</span>
        <span class="cm">/* 分辨率和布局 */</span>
        <span class="n">SSD1306_SET_DISP_START_LINE</span><span class="p">,</span>    <span class="c1">//设置显示的开始行为0（后面没有设置参数就为0）</span>
        <span class="n">SSD1306_SET_SEG_REMAP</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">,</span>   <span class="c1">//重新映射分区，列地址127被映射到SEG0</span>
        <span class="n">SSD1306_SET_MUX_RATIO</span><span class="p">,</span>          <span class="c1">//设置多路传输速率</span>
        <span class="n">SSD1306_HEIGHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>             <span class="c1">//显示为高度减去1（因为这里是从0开始的）</span>
        <span class="n">SSD1306_SET_COM_OUT_DIR</span> <span class="o">|</span> <span class="mh">0x08</span><span class="p">,</span> <span class="c1">//输出扫描方向。这里是从底部往上扫描，也就是COM[N-1]到COM0</span>
        <span class="n">SSD1306_SET_DISP_OFFSET</span><span class="p">,</span>        <span class="c1">//设置显示的偏移量</span>
        <span class="mh">0x00</span><span class="p">,</span>                           <span class="c1">//设置为无偏移</span>
        <span class="n">SSD1306_SET_COM_PIN_CFG</span><span class="p">,</span>        <span class="c1">//设置COM（common）针脚硬件配置。板子会指定一个特殊值</span>

<span class="cm">/* 128x32分辨率会使用0x02，128x64分辨率可以使用0x12，如果不能正常工作，那么使用0x22或0x32 */</span>
<span class="cp">#if ((SSD1306_WIDTH == 128) &amp;&amp; (SSD1306_HEIGHT == 32))
</span>        <span class="mh">0x02</span><span class="p">,</span>
<span class="cp">#elif ((SSD1306_WIDTH == 128) &amp;&amp; (SSD1306_HEIGHT == 64))
</span>        <span class="mh">0x12</span><span class="p">,</span>
<span class="cp">#else
</span>        <span class="mh">0x02</span><span class="p">,</span>
<span class="cp">#endif
</span>        
        <span class="cm">/* 计时和驱动规划 */</span>
        <span class="n">SSD1306_SET_DISP_CLK_DIV</span><span class="p">,</span>       <span class="c1">//设置显示的时钟除法比（divide ratio，这个中文术语是啥？）</span>
        <span class="mh">0x80</span><span class="p">,</span>                           <span class="c1">//标准频率中1的除法比</span>
        <span class="n">SSD1306_SET_PRECHARGE</span><span class="p">,</span>          <span class="c1">//设置每次交换的周期</span>
        <span class="mh">0xF1</span><span class="p">,</span>                           <span class="c1">//板子上产生的Vcc</span>
        <span class="n">SSD1306_SET_VCOM_DESEL</span><span class="p">,</span>         <span class="c1">//设置VCOMH取消级别</span>
        <span class="mh">0x30</span><span class="p">,</span>                           <span class="c1">//0.83xVcc</span>
        <span class="cm">/* 显示 */</span>
        <span class="n">SSD1306_SET_CONTRAST</span><span class="p">,</span>           <span class="c1">//设置对比度</span>
        <span class="mh">0xFF</span><span class="p">,</span>							<span class="c1">//设置为满的0xFF</span>
        <span class="n">SSD1306_SET_ENTIRE_ON</span><span class="p">,</span>          <span class="c1">//设置整个显示器来跟随RAM内容（也就是显示 RAM的内容）</span>
        <span class="n">SSD1306_SET_NORM_DISP</span><span class="p">,</span>          <span class="c1">//设置常规显示（不是颠倒的）</span>
        <span class="n">SSD1306_SET_CHARGE_PUMP</span><span class="p">,</span>        <span class="c1">//设置充电泵 set charge pump</span>
        <span class="mh">0x14</span><span class="p">,</span>                           <span class="c1">//板子上产生的Vcc</span>
        <span class="n">SSD1306_SET_SCROLL</span> <span class="o">|</span> <span class="mh">0x00</span><span class="p">,</span>      <span class="c1">//设置这个会停用水平滚动。这很重要，因为如果启用了滚动，那么当内存写入将出错</span>
        <span class="n">SSD1306_SET_DISP</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">,</span> <span class="c1">//打开显示器</span>
    <span class="p">};</span>

    <span class="n">SSD1306_send_cmd_list</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="n">count_of</span><span class="p">(</span><span class="n">cmds</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="渲染相关的代码">渲染相关的代码</h4>

<p>接下来编写渲染函数，这会将缓冲里的数据渲染到显示器上：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">render</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">struct</span> <span class="n">render_area</span> <span class="o">*</span><span class="n">area</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//用*area更新显示器的某个区域</span>
    <span class="kt">uint8_t</span> <span class="n">cmds</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">SSD1306_SET_COL_ADDR</span><span class="p">,</span>
        <span class="n">area</span><span class="o">-&gt;</span><span class="n">start_col</span><span class="p">,</span>
        <span class="n">area</span><span class="o">-&gt;</span><span class="n">end_col</span><span class="p">,</span>
        <span class="n">SSD1306_SET_PAGE_ADDR</span><span class="p">,</span>
        <span class="n">area</span><span class="o">-&gt;</span><span class="n">start_page</span><span class="p">,</span>
        <span class="n">area</span><span class="o">-&gt;</span><span class="n">end_page</span>
    <span class="p">};</span>
    
    <span class="n">SSD1306_send_cmd_list</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="n">count_of</span><span class="p">(</span><span class="n">cmds</span><span class="p">));</span>
    <span class="n">SSD1306_send_buf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">area</span><span class="o">-&gt;</span><span class="n">buflen</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>接下来是处理字符，需要将之前那个字符集找到需要的字符，然后经过转换和传递，最后将其显示到屏幕上：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* 从字符集从获取字符ch的下标 */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">GetFontIndex</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">&gt;=</span> <span class="sc">' '</span> <span class="o">&amp;&amp;</span> <span class="n">ch</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>  <span class="n">ch</span> <span class="o">-</span> <span class="sc">' '</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span>  <span class="mi">0</span><span class="p">;</span> <span class="c1">//如果没找到返回空格的下标</span>
<span class="p">}</span>

<span class="cm">/* 输出一个字符ch到buf，起始位置为（x, y） */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">WriteChar</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int16_t</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int16_t</span> <span class="n">y</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">//如果超出屏幕了</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">SSD1306_WIDTH</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">SSD1306_HEIGHT</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="c1">//之前说过每一行其实是一页，一页的高度是8个像素，这里的y也是行的上界。</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>
	
	<span class="c1">//获取字符ch的下标</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">GetFontIndex</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
    <span class="c1">//这里是计算了实际初始位置，也就是第几行（y * 128）的第几个（x）</span>
    <span class="kt">int</span> <span class="n">fb_idx</span> <span class="o">=</span> <span class="n">y</span> <span class="o">*</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">x</span><span class="p">;</span>

	<span class="c1">//输出字符ch的每一位</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">buf</span><span class="p">[</span><span class="n">fb_idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span><span class="p">[</span><span class="n">idx</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* 输出多个字符就是输出字符串了 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">WriteString</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int16_t</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int16_t</span> <span class="n">y</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">SSD1306_WIDTH</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">||</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="n">SSD1306_HEIGHT</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">WriteChar</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span><span class="p">);</span>
        <span class="n">x</span><span class="o">+=</span><span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="dht11运行原理">DHT11运行原理</h4>

<p>接下来编写代码从 DHT11 中读取数据。在这之前需要知道 DHT11 的工作机制，才知道如何编写代码。整体流程如下：</p>

<p><img src="/assets/images/9cbfb88ed5ea4c87800b294e05c9f44a.png" alt="请添加图片描述" /></p>

<p>其中各部分如下：</p>

<p><img src="/assets/images/f4dd56b1b79846249f36dadbf9f1f7ec.png" alt="请添加图片描述" /></p>

<p>传递数据的时候根据以下信号来判断是<code class="language-plaintext highlighter-rouge">0</code>还是<code class="language-plaintext highlighter-rouge">1</code>：
<img src="/assets/images/8e3ce9ad0f1b407eb0d7c7c9317884f7.png" alt="请添加图片描述" /></p>

<p><img src="/assets/images/f91aa0f0bc8444e4a7a1079bf133e6ae.png" alt="请添加图片描述" /></p>

<p>这里的时长要需要注意：</p>
<ol>
  <li>最开始 Pico 发送万开始信号和拉低电压必须不少于 18ms，这样 DHT11 才能获取信号；</li>
  <li>接下来 Pico 拉高电压等待 DHT11 回应需要 20～40us。<strong>这点一定要注意</strong>，因为<code class="language-plaintext highlighter-rouge">pico-examples</code>中相关代码并没有等待回应的时间，这会导致无法获取数据，或者获取数据一段时间后失败；</li>
  <li>DHT11 发送回应并且会保持 80us，然后再拉高电平再保持80us；</li>
  <li>传递数据的时候，50us 低电平和 26～28us 高电平意味着数据一位<code class="language-plaintext highlighter-rouge">0</code>，50us 低电平和 70us 高电平意味着数据一位<code class="language-plaintext highlighter-rouge">1</code>。</li>
  <li>此外，DHT11在通电的前 1000ms 内无法获取数据，最快响应时间为6秒，最慢为 30s。每次通信大约需要 4ms。</li>
</ol>

<p>DHT11 发送的 40 位数据先发高位的，内容为：8 位湿度整数数 + 8位湿度浮点数 + 8 位温度整数数 + 8位温度浮点数 + 8 位校验和。</p>
<h4 id="dht11相关代码和运行原理">DHT11相关代码和运行原理</h4>

<p>首先设置连接的 GPIO 针脚是哪一个，以及设置最大时长：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">uint</span> <span class="n">DHT_PIN</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="k">const</span> <span class="n">uint</span> <span class="n">MAX_TIMINGS</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
</code></pre></div></div>

<p>然后声明一个结构体用来存放 DHT11 获取的湿度和温度：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">humidity</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">temperature</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dht_reading</span><span class="p">;</span>
</code></pre></div></div>

<p>接下来编写从 DHT11 读取数据的函数：</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">read_from_dht</span><span class="p">(</span><span class="n">dht_reading</span> <span class="o">*</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//信号值有40bit，也就是5个字节</span>
    <span class="kt">int</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
    <span class="c1">//纪录上一种信号的类型</span>
    <span class="n">uint</span> <span class="n">last</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">//纪录当前信号是第几位数据</span>
    <span class="n">uint</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="cm">/* Pico发送信号阶段 */</span> 
    <span class="c1">//信号方向是DHT_PIN到GPIO_OUT，给DHT11发送一些信号。这里的dir是direction</span>
    <span class="n">gpio_set_dir</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">);</span>
    <span class="c1">//给DHT_PIN输出低电平，并且维持18ms，这样让DHT11可以获取到这个信号</span>
    <span class="n">gpio_put</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">sleep_ms</span><span class="p">(</span><span class="mi">18</span><span class="p">);</span>
    <span class="c1">//给DHT_PIN输出高电平，维持40us，用来等待 DHT11 的回应</span>
    <span class="n">gpio_put</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">sleep_us</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>

	<span class="cm">/* DHT发送信号阶段 */</span> 
    <span class="c1">//反转信号方向，从DHT_PIN到GPIO_IN，这样来获取DHT11的数据</span>
    <span class="n">gpio_set_dir</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">,</span> <span class="n">GPIO_IN</span><span class="p">);</span>
    
	<span class="c1">//这里开始获取和处理DHT11的输出的信号</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">uint</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_TIMINGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    	<span class="c1">//count用来计时的，单位为255</span>
        <span class="n">uint</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="c1">//如果获取的电平与上一个信号的电平相同，那么一直循环，这个用来消耗上文提到的等待时间</span>
        <span class="c1">//一开始DHT11有80us的低电平来作为回复，所以第一次循环的时候last为1（高电平）就直接跳过循环了，然后last也变成了0（低电平）。这样第二次循环的时候就会进入下面的循环耗时间。DHT11拉高电平之后就重复一遍这个操作</span>
        <span class="c1">//后续DHT11信号前面的50us也是这样处理的</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">gpio_get</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">last</span><span class="p">)</span> <span class="p">{</span>
        	<span class="c1">//开始迭代计数进行计时</span>
            <span class="n">count</span><span class="o">++</span><span class="p">;</span>
            <span class="n">sleep_us</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="c1">//如果当前时常已经超过100us，那么这次整个外层迭代跳过，但是由于break只能跳过一层迭代，所以外层还要break一次</span>
            <span class="c1">//选择任意大于信号最大周期的值即可，不一定是100</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">100</span><span class="p">)</span> 
            	<span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//将当前电平赋值给DHT_PIN</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">gpio_get</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">);</span>
        <span class="c1">//这个判断可不是多余的，这是用来彻底跳出外层迭代。不然会出现先显示湿度和温度的整数部分，再显示湿度和温度的浮点部分。一次获取无法获取完整的数据</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">==</span> <span class="mi">100</span><span class="p">)</span> 
			<span class="k">break</span><span class="p">;</span>

		<span class="c1">//这里开始获取数据了</span>
		<span class="c1">//i&gt;=4是因为前三个循环里分别是回应保持低电平、拉高电平和第一个数据位开始的50us</span>
		<span class="c1">//i % 2 == 0是因为奇数次都是数据位开始的50us，没有存放的数据</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        	<span class="c1">//j/8刚好可以表示这是第几个字节</span>
        	<span class="c1">//右移一位，这样8bit的数据只用设置最右的一位即可</span>
            <span class="n">data</span><span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="c1">//如果当前信号超过35，那么将最右一位设置为1</span>
            <span class="c1">//这个35是因为26～28表示0，大于这个范围的便表示1了，但是由于通信时间可能需要一段时间，所以留了一些冗余</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">35</span><span class="p">)</span> 
            	<span class="n">data</span><span class="p">[</span><span class="n">j</span> <span class="o">/</span> <span class="mi">8</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">j</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

	<span class="c1">//获取到40位数据并且校验和(data[4] == ((data[0] + data[1] + data[2] + data[3]) &amp; 0xFF))也是对的，那么将结果保存到result指针指向的结构体中</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)))</span> <span class="p">{</span>
        <span class="n">result</span><span class="o">-&gt;</span><span class="n">humidity</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">humidity</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span><span class="o">-&gt;</span><span class="n">humidity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="n">result</span><span class="o">-&gt;</span><span class="n">temperature</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="p">(((</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">temperature</span> <span class="o">&gt;</span> <span class="mi">125</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span><span class="o">-&gt;</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">result</span><span class="o">-&gt;</span><span class="n">temperature</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    	<span class="c1">//如果数据不对那么打印debug信息</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Bad data</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="main函数"><code class="language-plaintext highlighter-rouge">main</code>函数</h4>
<p>这里是整个程序的主体了，将使用上面声明的函数来实现需要的效果：</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">stdio_init_all</span><span class="p">();</span>
    <span class="cm">/* 初始化 GPIO */</span>
    <span class="n">gpio_init</span><span class="p">(</span><span class="n">DHT_PIN</span><span class="p">);</span>
    
    <span class="cm">/* 初始化默认的i2c控制器以及针脚 */</span>
    <span class="n">i2c_init</span><span class="p">(</span><span class="n">i2c_default</span><span class="p">,</span> <span class="n">SSD1306_I2C_CLK</span><span class="p">);</span>
    <span class="n">gpio_set_function</span><span class="p">(</span><span class="n">PICO_DEFAULT_I2C_SDA_PIN</span><span class="p">,</span> <span class="n">GPIO_FUNC_I2C</span><span class="p">);</span>
    <span class="n">gpio_set_function</span><span class="p">(</span><span class="n">PICO_DEFAULT_I2C_SCL_PIN</span><span class="p">,</span> <span class="n">GPIO_FUNC_I2C</span><span class="p">);</span>
    <span class="n">gpio_pull_up</span><span class="p">(</span><span class="n">PICO_DEFAULT_I2C_SDA_PIN</span><span class="p">);</span>
    <span class="n">gpio_pull_up</span><span class="p">(</span><span class="n">PICO_DEFAULT_I2C_SCL_PIN</span><span class="p">);</span>
    
    <span class="cm">/* 初始化SSD1306 */</span>
    <span class="n">SSD1306_init</span><span class="p">();</span>

    <span class="cm">/* 初始化 frame_area 渲染区域（大小为SSD1306_WIDTH乘以SSD1306_NUM_PAGES） */</span>
    <span class="k">struct</span> <span class="n">render_area</span> <span class="n">frame_area</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nl">start_col:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">end_col</span> <span class="o">:</span> <span class="n">SSD1306_WIDTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">start_page</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">end_page</span> <span class="o">:</span> <span class="n">SSD1306_NUM_PAGES</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="p">};</span>
    
    <span class="cm">/* 计算frame_area图像缓冲长度 */</span>
    <span class="n">calc_render_area_buflen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">frame_area</span><span class="p">);</span>
    
    <span class="cm">/* 声明一个数组来存放缓冲，长度为上面的计算的 */</span>
    <span class="kt">uint8_t</span> <span class="n">buf</span><span class="p">[</span><span class="n">SSD1306_BUF_LEN</span><span class="p">];</span>
    <span class="cm">/* 预先清空缓冲和屏幕 */</span>
    <span class="c1">//给这个数组每个元素分配为0（因为可能这个内存之前没有被清空，这样会显示花屏）</span>
    <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SSD1306_BUF_LEN</span><span class="p">);</span>
    <span class="c1">//然后渲染这个缓冲</span>
    <span class="n">render</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_area</span><span class="p">);</span>
    
    <span class="c1">//存放温度和湿度的字符串，方便后面渲染到屏幕上</span>
    <span class="kt">char</span> <span class="n">temp</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">hum</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="c1">//第一次之前等待1000ms，不然可能第一次获取数据会失败</span>
	<span class="n">sleep_ms</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	
    <span class="cm">/* 不断循环获取数据并且渲染到屏幕上 */</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    	<span class="c1">//声明一个dht_reading变量：reading，然后将从DHT11读取的数据存放到reading中</span>
        <span class="n">dht_reading</span> <span class="n">reading</span><span class="p">;</span>
        <span class="n">read_from_dht</span><span class="p">(</span><span class="o">&amp;</span><span class="n">reading</span><span class="p">);</span>
        
        <span class="c1">//给这个数组每个元素分配为0，不然上次显示的内容可能还在缓冲中，这样下次渲染显示会出问题</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SSD1306_BUF_LEN</span><span class="p">);</span>
		
		<span class="c1">//生成字符串用来打印，分别存放到temp和hum字符数组中，然后再将其写入到缓冲数组buf中</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="s">"temp = %.02f C"</span><span class="p">,</span> <span class="n">reading</span><span class="p">.</span><span class="n">temperature</span><span class="p">);</span>
        <span class="c1">//这个printf是给串口USB输出，后面演示可以看到</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"temp = %.02f C</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">reading</span><span class="p">.</span><span class="n">temperature</span><span class="p">);</span>
        <span class="n">WriteString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">hum</span><span class="p">,</span> <span class="s">"hum  = %.02f %%"</span><span class="p">,</span> <span class="n">reading</span><span class="p">.</span><span class="n">humidity</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"hum  = %.02f %%</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">reading</span><span class="p">.</span><span class="n">humidity</span><span class="p">);</span>
        <span class="c1">//由于行高为8，所以第二行写入的y值要加8，当然你如果想让行距好看一些，可以设置为10，比如说这里</span>
        <span class="n">WriteString</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hum</span><span class="p">);</span>
        
        <span class="c1">//渲染缓冲</span>
        <span class="n">render</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frame_area</span><span class="p">);</span>
        
        <span class="c1">//等待6000ms，因为DHT11的最小响应时间为6秒</span>
        <span class="n">sleep_ms</span><span class="p">(</span><span class="mi">6000</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="cmakeliststxt"><code class="language-plaintext highlighter-rouge">CMakeLists.txt</code></h3>

<p>然后在<code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>文件中放入以下内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmake_minimum_required(VERSION 3.12)

include(pico_sdk_import.cmake)

project(pico-temp-hum)

pico_sdk_init()

if (TARGET tinyusb_device)
	add_executable(pico-temp-hum
        	pico-temp-hum.c
        )

    # 添加依赖项
    target_link_libraries(pico-temp-hum pico_stdlib hardware_adc hardware_i2c)

    # 激活USB输出，关闭UART输出（也可以全开）
    pico_enable_stdio_usb(pico-temp-hum 1)
    pico_enable_stdio_uart(pico-temp-hum 0)

    # 创建映射/bin/hex/uf2等文件
    pico_add_extra_outputs(pico-temp-hum)

elseif(PICO_ON_DEVICE)
    message(WARNING "not building hello_usb because TinyUSB submodule is not initialized in the SDK")
endif()
</code></pre></div></div>

<h2 id="构建项目以及烧录">构建项目以及烧录</h2>

<p>首先进入<code class="language-plaintext highlighter-rouge">build</code>目录：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cd build
</code></pre></div></div>

<p>然后使用以下命令进行构建：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cmake .. &amp;&amp; make -j6
...
[ 98%] Building C object CMakeFiles/pico-temp-hum.dir/Users/zhongyijiang/Desktop/pico/pico-sdk/src/rp2_common/hardware_i2c/i2c.c.obj
[100%] Linking CXX executable pico-temp-hum.elf
[100%] Built target pico-temp-hum
</code></pre></div></div>

<p>接下来将其烧录到 Pico 上。先按住 Pico 上的“BOOTSEL”按钮，再插入线缆连接到电脑，这时候 Pico 会进入 USB 存储模式。</p>

<p>然后将构建出来的<code class="language-plaintext highlighter-rouge">pico-temp-hum.uf2</code>拖入其中即可。如果是只能使用终端那么可以使用以下命令：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cp pico-temp-hum.uf2 /Volumes/RPI-RP2/pico-temp-hum.uf2
</code></pre></div></div>

<p>这是 macOS 的版本，如果你使用的是 Ubuntu 或者 WSL，那么将<code class="language-plaintext highlighter-rouge">/Volumes/</code>改成<code class="language-plaintext highlighter-rouge">/dev/</code>即可（<code class="language-plaintext highlighter-rouge">RPI-RP2</code>可能也需要小写）。</p>

<p>这时候会显示异常弹出，这是正常的不用担心。</p>

<h2 id="最终成果">最终成果</h2>
<p>这时候你就能看到这样的效果啦：</p>

<p><img src="/assets/images/d81f513cd42a487a94ab511d8b00622f.jpeg" alt="请添加图片描述" /></p>

<p>如果你使用串行交流程序查看的话，比如<code class="language-plaintext highlighter-rouge">minicom</code>，使用的命令如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ minicom -D /dev/cu.usbmodem1431301 -b 115200
</code></pre></div></div>

<p>这里的<code class="language-plaintext highlighter-rouge">cu.usbmodem1431301</code>不是一定的，每次连接的值都有可能不同，需要根据实际情况进行修改。</p>

<p>在串行交流程序中会看到下面的情况：</p>

<p><img alt="" src="/assets/images/64f939e019b94483af63d9284333179b.png" style="box-shadow: 0px 0px 0px 0px" /></p>

<p>可以看到除了<code class="language-plaintext highlighter-rouge">%</code>因为传递问题没显示好，其他都一切正常，和 OLED 上显示的一样。</p>

<p>我将完整的项目放到了<a href="https://github.com/ZhongUncle/pico-temp-hum-oled">GitHub-ZhongUncle/pico-temp-hum-oled</a>，并且在<code class="language-plaintext highlighter-rouge">build</code>目录下放了编译好的内容，方便读者进行尝试。</p>

<h2 id="扩展阅读">扩展阅读</h2>
<p>这里有一些扩展资料，是我在研究过程中发现或者参考的，还有一些我在这个过程中写的博客，感兴趣可以看看。</p>

<p><a href="https://www.digikey.com/htmldatasheets/production/2047793/0/0/1/SSD1306.pdf">《SSD1306 Advance Information》</a> 这个相当于 SSD1306 的参数表，里面介绍了很多信息，包括文中提到的命令等信息。</p>

<p><a href="https://www.mouser.com/datasheet/2/758/DHT11-Technical-Data-Sheet-Translated-Version-1143054.pdf">《DHT11 Humidity &amp; Temperature Sensor》</a> 这是一份 DHT11 的文档，介绍了一些相关信息和运行机制，上文中的截图就来自于此。需要注意不同厂商的 DHT11 文档不一样，这份虽然不长，但是内容详尽得多。</p>

<p><a href="https://learn.sparkfun.com/tutorials/i2c/all">https://learn.sparkfun.com/tutorials/i2c/all</a> 这是一篇介绍 I2C 的文章，如果不了解 I2C 可以看看。</p>

<p><a href="https://forums.raspberrypi.com/viewtopic.php?t=338243">https://forums.raspberrypi.com/viewtopic.php?t=338243</a> 这篇帖子有人询问如何修改默认 I2C 针脚，然后树莓派官方工程师回答了方法：</p>

<p><img src="/assets/images/d430b95834c54b88bd104ef003be72bb.png" alt="请添加图片描述" /></p>

<p>但是其中定义在源代码中的方法不太对，正如他所说的不确定。所以我通过实践总结了这些方法，并且写了一篇博客：<a href="/blogs/911891686f4a77e37082c2b4210451c9.html">《用C/C++修改I2C默认的SDA和SCL针脚》</a></p>

<p>然后我经过自己刨根问底式的探究了如何制定某个针脚，而不是使用默认值或者修改默认值：<a href="/blogs/5f1a7fd5d52116befdae2e8e54b10888.html">《Pico如何使用C/C++选择使用哪个I2C控制器，以及SDA和SCL针脚》</a></p>

<p>此外，对于<code class="language-plaintext highlighter-rouge">_u</code>这个宏是什么意思我是通过这篇帖子知道的：<a href="https://forums.raspberrypi.com/viewtopic.php?t=330222#:~:text=#ifndef%20_u%20#ifdef%20__ASSEMBLER__%20#define%20_u%20%28x%29%20x,where%20the%20u%20suffix%20would%20have%20been%20illegal.">#define _u macro?</a></p>

<p>希望能帮到有需要的人～</p>

        </div>
    </body>
</html>