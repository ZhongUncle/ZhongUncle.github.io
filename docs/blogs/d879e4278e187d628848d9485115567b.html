<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='en'>
        <title>搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="本文是一个类似手册的文章，用来记录可能遇到的错误。你可以通过侧栏选择遇到的错误来查看详细信息。 No install step for ‘ELF2UF2Build’ 遇到这种错误有两种原因： 安装了版本不对或者不完整的arm-none-eabi-gcc； 没有使用正确的 C/C++ 的编译器，导致编译出来的elf2uf2不对；" />
<meta property="og:description" content="本文是一个类似手册的文章，用来记录可能遇到的错误。你可以通过侧栏选择遇到的错误来查看详细信息。 No install step for ‘ELF2UF2Build’ 遇到这种错误有两种原因： 安装了版本不对或者不完整的arm-none-eabi-gcc； 没有使用正确的 C/C++ 的编译器，导致编译出来的elf2uf2不对；" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/d879e4278e187d628848d9485115567b.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/d879e4278e187d628848d9485115567b.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-10T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-08-10T00:00:00+08:00","datePublished":"2023-08-10T00:00:00+08:00","description":"本文是一个类似手册的文章，用来记录可能遇到的错误。你可以通过侧栏选择遇到的错误来查看详细信息。 No install step for ‘ELF2UF2Build’ 遇到这种错误有两种原因： 安装了版本不对或者不完整的arm-none-eabi-gcc； 没有使用正确的 C/C++ 的编译器，导致编译出来的elf2uf2不对；","headline":"搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/d879e4278e187d628848d9485115567b.html"},"url":"https://zhonguncle.github.io/blogs/d879e4278e187d628848d9485115567b.html"}</script>
<!-- End Jekyll SEO tag -->

        
        <!-- Microsoft Clarity -->
        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "ix8xlal10a");
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS87H0FDV7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SS87H0FDV7');
        </script>
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/mcu.html" class="headerItem">
            MCU
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>搭建树莓派Pico交叉编译环境和工具链（arm-none-eabi-gcc）时可能会遇到的错误以及解决方案</h1>
            <div class="bloginfo">
                <p class="info">2023-08-10 ｜ <a href="/mcu.html"> MCU</a> ｜ #Words: 1056 </p>
            </div>
            <!-- excerpt-start -->
<p>本文是一个类似手册的文章，用来记录可能遇到的错误。你可以通过侧栏选择遇到的错误来查看详细信息。</p>
<h1 id="no-install-step-for-elf2uf2build">No install step for ‘ELF2UF2Build’</h1>
<p>遇到这种错误有两种原因：</p>
<ol>
  <li>安装了版本不对或者不完整的<code class="language-plaintext highlighter-rouge">arm-none-eabi-gcc</code>；</li>
  <li>没有使用正确的 C/C++ 的编译器，导致编译出来的<code class="language-plaintext highlighter-rouge">elf2uf2</code>不对；</li>
</ol>

<h2 id="第一种原因">第一种原因</h2>
<p>一般出现在使用<code class="language-plaintext highlighter-rouge">brew</code>安装的情况，这时候用下面的命令卸载、清理掉<code class="language-plaintext highlighter-rouge">brew</code>安装的内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># 卸载arm-none-eabi-gcc
$ brew uninstall arm-none-eabi-gcc
# 清理掉一些下载文件
$ brew cleanup arm-none-eabi-gcc
# brew默认将二进制文件安装到/usr/local/bin/目录下，虽然前面卸载了，但是可能会有一些残留，手动删一下
$ sudo rm /usr/local/bin/arm-none-eabi-*
</code></pre></div></div>

<p>这时候再从官网下载安装即可。进入 <a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads">Arm GNU Toolchain Downloads</a>，用页面搜索功能搜一下“macOS”，因为链接太多了。选择你对应平台（就是处理器架构）的<code class="language-plaintext highlighter-rouge">AArch32 bare-metal target (arm-none-eabi)</code>中的链接点击下载。选择<code class="language-plaintext highlighter-rouge">AArch32</code>因为树莓派 Pico 的微控制器 RP2040 包含的 Arm Cortex M0 是 32 位的，也就是<code class="language-plaintext highlighter-rouge">AArch32</code>，如果你下成<code class="language-plaintext highlighter-rouge">AArch64 bare-metal target (aarch64-none-elf)</code>是没法编译的。</p>

<h2 id="第二种原因">第二种原因</h2>
<p>这种原因的解决方法就是设置环境变量<code class="language-plaintext highlighter-rouge">CMAKE_C_COMPILER</code>和<code class="language-plaintext highlighter-rouge">CMAKE_CXX_COMPILER</code>来让<code class="language-plaintext highlighter-rouge">cmake</code>知道选择哪个编译器作为 C 和 C++ 代码的编译器，不然会默认选择本地的 Clang 作为编译器，但是这种编译器是编译不出我们需要的程序的。</p>

<p>这时候有两种解决方案。</p>
<h3 id="在你的-shell-配置文件进行设置">在你的 Shell 配置文件进行设置</h3>
<p>这时候你可以选择在你的 Shell 配置文件中加入以下语句（后面的路径需要根据自己的设置进行修改）：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export CC="/usr/local/bin/arm-none-eabi-gcc"
export CXX="/usr/local/bin/arm-none-eabi-g++"
</code></pre></div></div>

<p>或者</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export CMAKE_C_COMPILER="/usr/local/bin/arm-none-eabi-gcc"
export CMAKE_CXX_COMPILER="/usr/local/bin/arm-none-eabi-g++"
</code></pre></div></div>

<p>然后使用<code class="language-plaintext highlighter-rouge">source</code>来激活这个更改，或者你也可以关闭终端再次打开。</p>

<h3 id="在cmakeliststxt中进行设置">在CMakeLists.txt中进行设置</h3>
<p>你可以在 CMake 项目中的<code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>配置文件中进行设置，在 <code class="language-plaintext highlighter-rouge">project(...)</code>之前加上下面几句话：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set(CMAKE_C_COMPILER /usr/local/bin/arm-none-eabi-gcc)
set(CMAKE_CXX_COMPILER /usr/local/bin/arm-none-eabi-g++)
</code></pre></div></div>

<p>然后清空构建目标目录<code class="language-plaintext highlighter-rouge">build</code>，再进行构建即可。</p>

<h1 id="fatal-error-cannot-read-spec-file-nosysspecs-no-such-file-or-directory">fatal error: cannot read spec file ‘nosys.specs’: No such file or directory，</h1>
<p><code class="language-plaintext highlighter-rouge">fatal error: cannot read spec file ‘nosys.specs’: No such file or directory</code>显示了读取不了<code class="language-plaintext highlighter-rouge">nosys.specs</code>文件，这可能是因为需要读取<code class="language-plaintext highlighter-rouge">nosys.specs</code>的时候，<code class="language-plaintext highlighter-rouge">nosys.specs</code>还未准备好。这种错误一般出现在使用<code class="language-plaintext highlighter-rouge">make</code>最后构建二进制文件的时候。解决方法就是使用<code class="language-plaintext highlighter-rouge">make -j4</code>（个人测试至少为<code class="language-plaintext highlighter-rouge">4</code>）来同时处理 4 个任务，这样这个错误就消失了。</p>

<h1 id="连接错误">连接错误</h1>
<p>这种错误信息很多，主要表现为：编译错误，查看信息发现是<code class="language-plaintext highlighter-rouge">ld</code>或者<code class="language-plaintext highlighter-rouge">arm-none-eabi-ld</code>导致的。这是因为最后连接器使用的<code class="language-plaintext highlighter-rouge">-isysroot</code>参数错误，一般这种错误是因为连接到的是本地的 SDK，而不是Linux需要的<code class="language-plaintext highlighter-rouge">.so</code>文件。</p>

<p>这种错误需要在 CMake 项目中的<code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>配置文件中、 <code class="language-plaintext highlighter-rouge">project(...)</code>之前加上下面几句话（后面的路径需要根据自己的设置进行修改）：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set(CMAKE_SYSROOT /usr/local/lib/arm-none-eabi/bfd-plugins/libdep.so)
</code></pre></div></div>

<p>然后清空构建目录<code class="language-plaintext highlighter-rouge">build</code>，再次进行构建即可。</p>

<p>有些错误因为我没记笔记一时想不起来，后面想起来再进行补充。希望能帮到有需要的人～</p>

        </div>
    </body>
</html>