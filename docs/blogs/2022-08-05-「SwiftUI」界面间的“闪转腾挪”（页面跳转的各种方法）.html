<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>「SwiftUI」界面间的“闪转腾挪”（页面跳转的各种方法）</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swiftui.html" class="headerItem">
            SwiftUI
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
</div>
            <h1>「SwiftUI」界面间的“闪转腾挪”（页面跳转的各种方法）</h1>
            <div class="bloginfo">
                <p class="info">2022-08-05 ｜ <a href="/swiftui.html"> SwiftUI</a> ｜ 1901 字</p>
            </div>
            
            <!-- excerpt-start -->
<p>在开发过程中，我们经常需要在多个界面之间“闪转腾挪”，在SwiftUI有两种方法：</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">NavigationView</code>法：最常见的方法。每层之间都可以传递数据。由于是一层一层界面跳转，不过不适合几个界面之间跳转。<strong>这个方法从 iOS 16 开始被废弃了，新的办法请移步：<a href="https://blog.csdn.net/qq_33919450/article/details/128010630">《如何使用新的NavigationStack和NavigationSplitView（如何页面跳转2.0以及如何制作侧栏）》</a></strong>（2022-11-24更新）。</li>
  <li>指定跳转法：可以几个界面之间跳转。不过问题在于界面数据不太方便传递，只适合“写定”的界面之间（使用时界面不能带参数）。</li>
</ul>

<h2 id="navigationview-法">NavigationView 法：</h2>

<p>这个方法使用<code class="language-plaintext highlighter-rouge">Navigationlink</code>来指定需要跳转到的界面，也是最常见的方法。使用起来有两种方法，不过这两种方法都需要包裹在<code class="language-plaintext highlighter-rouge">NavigationView</code>中：</p>
<h3 id="直接把navigationlink当按钮点击跳转">直接把<code class="language-plaintext highlighter-rouge">NavigationLink</code>当按钮，点击跳转</h3>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="nv">destination</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">需要跳转到的界面</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="o">&lt;</span><span class="n">跳转链接样式</span><span class="o">&gt;</span> <span class="p">}</span>
</code></pre></div></div>
<p>这个太简单了，一般很少用。使用方法和按钮<code class="language-plaintext highlighter-rouge">Button</code>一样。</p>

<h3 id="推荐用一个布尔值触发跳转根据条件跳转界面">【推荐】用一个布尔值触发跳转（根据条件跳转界面）</h3>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NavigationLink</span><span class="p">(</span><span class="nv">destination</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">需要跳转到的界面</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">isActive</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">用于激活跳转的一个布尔值</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="kt">EmptyView</span><span class="p">()</span> <span class="p">}</span>
</code></pre></div></div>
<p>这种方法使用一个<code class="language-plaintext highlighter-rouge">EmptyView()</code>让其不显示在界面中，但是可以被触发，有时候需要使用<code class="language-plaintext highlighter-rouge">ZStack</code>压到最下面。
这种方法使用场景就多了，比如说达到一定条件可以跳转到某个界面。</p>

<p>比如下面这个点击按钮就可以跳转哦。</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
	<span class="c1">//这个就是触发跳转的布尔值</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">isShowingDetailView</span> <span class="o">=</span> <span class="kc">false</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">NavigationView</span> <span class="p">{</span>
            <span class="kt">VStack</span> <span class="p">{</span>
                <span class="kt">NavigationLink</span><span class="p">(</span><span class="nv">destination</span><span class="p">:</span> <span class="kt">DetailView</span><span class="p">(),</span> <span class="nv">isActive</span><span class="p">:</span> <span class="err">$</span><span class="n">isShowingDetailView</span><span class="p">)</span> <span class="p">{</span> <span class="kt">EmptyView</span><span class="p">()</span> <span class="p">}</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"ViewA"</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
                <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">isShowingDetailView</span> <span class="o">=</span> <span class="kc">true</span>
                <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                    <span class="kt">Text</span><span class="p">(</span><span class="s">"View B"</span><span class="p">)</span>
                <span class="p">})</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">DetailView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"ViewB"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>效果如下：</p>

<p><img src="/assets/images/2a83f4b57f1245df8b9c97f17762b17f.gif" alt="请添加图片描述" /></p>

<h2 id="指定跳转法">指定跳转法</h2>

<p>这是一个方法，而不是苹果提供的。相比较前者稍微难一些，而且在数据传递的时候受限比较多，但是在界面比较多的某些时候就可能会比较好用。</p>

<p>假设现在有三个界面<code class="language-plaintext highlighter-rouge">A</code>、<code class="language-plaintext highlighter-rouge">B</code>和<code class="language-plaintext highlighter-rouge">C</code>。需要依次点击跳转。</p>

<p>首先针对三个界面新建一个枚举：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">Views</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">view1</span>
    <span class="k">case</span> <span class="n">view2</span>
    <span class="k">case</span> <span class="n">view3</span>
<span class="p">}</span>
</code></pre></div></div>

<p>然后新建新建一个可观察对象<code class="language-plaintext highlighter-rouge">ViewRouter</code>，来控制当前显示的界面：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">ViewRouter</span><span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>
    <span class="c1">//当前界面发生变化的时候，将观察ViewRouter的视图，主界面要得到通知和更新————所以需要用@Published属性来wrap</span>
    <span class="c1">//@Published 属性包装器的工作原理与 @State 属性包装器非常相似。每次分配给包装的属性的值发生变化时，每个观察中视图都会重新渲染。</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">currentView</span><span class="p">:</span> <span class="kt">Views</span> <span class="o">=</span> <span class="o">.</span><span class="n">view1</span>
<span class="p">}</span>
</code></pre></div></div>

<p>新建一个名为<code class="language-plaintext highlighter-rouge">MainView</code>的 View 作为主界面：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//主界面</span>
<span class="kd">struct</span> <span class="kt">MainView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="c1">//实例化结构体：有两种方法，看一下注释讲了区别</span>
    <span class="c1">//@StateObject属性用于将View绑定到ObservableObjects————如果层级复杂，就不够用了，需要使用@EnvironmentObject</span>
<span class="c1">//    @StateObject var viewRouter = ViewRouter()</span>
    <span class="c1">//EnvironmentObject是一个数据模型，一旦初始化，可用于在应用程序的所有视图中共享信息————是由可观察对象创建的</span>
    <span class="c1">//该方法不能引导有属性的结构体，因为属性变化就不能用了</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">viewRouter</span><span class="p">:</span> <span class="kt">ViewRouter</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="c1">//根据viewRouter的currentView属性来显示相应的View</span>
        <span class="k">switch</span> <span class="n">viewRouter</span><span class="o">.</span><span class="n">currentView</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view1</span><span class="p">:</span>
            <span class="kt">ContentViewA</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view2</span><span class="p">:</span>
            <span class="kt">ContentViewB</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view3</span><span class="p">:</span>
            <span class="kt">ContentViewC</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>这个方法其实就是通过使用<code class="language-plaintext highlighter-rouge">switch</code>语句来更改当前显示的 View，被更改的则是之前新建结构体<code class="language-plaintext highlighter-rouge">ViewRouter</code>中的<code class="language-plaintext highlighter-rouge">currentView</code>。结构体<code class="language-plaintext highlighter-rouge">ViewRouter</code>中的<code class="language-plaintext highlighter-rouge">@Published var currentView: Views = .view1</code>表示默认显示<code class="language-plaintext highlighter-rouge">.view1</code>。</p>

<p>然后列出三个界面的代码，这里需要在按钮上更改结构体<code class="language-plaintext highlighter-rouge">ViewRouter</code>中的<code class="language-plaintext highlighter-rouge">currentView</code>。</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">MainView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">viewRouter</span><span class="p">:</span> <span class="kt">ViewRouter</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="c1">//根据viewRouter的currentView属性来显示相应的View</span>
        <span class="k">switch</span> <span class="n">viewRouter</span><span class="o">.</span><span class="n">currentView</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view1</span><span class="p">:</span>
            <span class="kt">ContentViewA</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view2</span><span class="p">:</span>
            <span class="kt">ContentViewB</span><span class="p">()</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">view3</span><span class="p">:</span>
            <span class="kt">ContentViewC</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//一级界面A</span>
<span class="kd">struct</span> <span class="kt">ContentViewA</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">viewRouter</span><span class="p">:</span> <span class="kt">ViewRouter</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"ViewA"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">viewRouter</span><span class="o">.</span><span class="n">currentView</span> <span class="o">=</span> <span class="o">.</span><span class="n">view2</span>
            <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Next B"</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="n">viewRouter</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//二级界面B</span>
<span class="kd">struct</span> <span class="kt">ContentViewB</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">viewRouter</span><span class="p">:</span> <span class="kt">ViewRouter</span>
    
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">showingDetailView</span> <span class="o">=</span> <span class="kc">false</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"ViewB"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">viewRouter</span><span class="o">.</span><span class="n">currentView</span> <span class="o">=</span> <span class="o">.</span><span class="n">view3</span>
            <span class="p">},</span> <span class="nv">label</span><span class="p">:</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Next C"</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="n">viewRouter</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//三级界面C</span>
<span class="kd">struct</span> <span class="kt">ContentViewC</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="kd">@EnvironmentObject</span> <span class="k">var</span> <span class="nv">viewRouter</span><span class="p">:</span> <span class="kt">ViewRouter</span>
    
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">showingDetailView</span> <span class="o">=</span> <span class="kc">false</span>
    
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"ViewC"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>然后在 Preview 的结构体，或者<code class="language-plaintext highlighter-rouge">@main</code>部分加上环境对象<code class="language-plaintext highlighter-rouge">.environmentObject(ViewRouter())</code>。如下：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">ContentView_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">MainView</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="kt">ViewRouter</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>或者：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">@main</span>
<span class="kd">struct</span> <span class="nv">viewApp</span><span class="p">:</span> <span class="kt">App</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">Scene</span> <span class="p">{</span>
        <span class="kt">WindowGroup</span> <span class="p">{</span>
            <span class="kt">MainView</span><span class="p">()</span>
                <span class="o">.</span><span class="nf">environmentObject</span><span class="p">(</span><span class="kt">ViewRouter</span><span class="p">())</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>效果如下：</p>

<p><img src="/assets/images/01b510bb0324429d948c52aba7f41de1.gif" alt="请添加图片描述" /></p>

<p>希望可以帮到有需要的人～</p>

        </div>
    </body>
</html>