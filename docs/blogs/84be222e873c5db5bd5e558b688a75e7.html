<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='en'>
        <title>「Updating」The syntax style of Apple's as assembler (different from the language style of Microsoft's masm assembler)</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>「Updating」The syntax style of Apple’s as assembler (different from the language style of Microsoft’s masm assembler) | ZhongUncle’s Blog</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="「Updating」The syntax style of Apple’s as assembler (different from the language style of Microsoft’s masm assembler)" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/blogs/84be222e873c5db5bd5e558b688a75e7.html" />
<meta property="og:url" content="http://localhost:4000/blogs/84be222e873c5db5bd5e558b688a75e7.html" />
<meta property="og:site_name" content="ZhongUncle’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-05-19T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="「Updating」The syntax style of Apple’s as assembler (different from the language style of Microsoft’s masm assembler)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-05-19T00:00:00+08:00","datePublished":"2023-05-19T00:00:00+08:00","headline":"「Updating」The syntax style of Apple’s as assembler (different from the language style of Microsoft’s masm assembler)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blogs/84be222e873c5db5bd5e558b688a75e7.html"},"url":"http://localhost:4000/blogs/84be222e873c5db5bd5e558b688a75e7.html"}</script>
<!-- End Jekyll SEO tag -->

        
        <!-- Microsoft Clarity -->
        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "ix8xlal10a");
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS87H0FDV7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SS87H0FDV7');
        </script>

        
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/mcu.html" class="headerItem">
            MCU
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>「Updating」The syntax style of Apple's as assembler (different from the language style of Microsoft's masm assembler)</h1>
            <div class="bloginfo">
                <p class="info">2023-05-19 ｜ <a href="/assembly.html"> Assembly</a> ｜ #Words: 486 </p>
            </div>
            <p>The syntax and style of assembly has two kinds in usual: AT&amp;T and Intel syntx.</p>

<p><code class="language-plaintext highlighter-rouge">as</code> is Apple’s assembler. The assembly code generated by Xcode is AT&amp;T syntax (Unix birthplace). The Microsoft’s <code class="language-plaintext highlighter-rouge">masm</code> style that most people learned in college is Intel syntax (You know, it is “Wintel”), so this blog will shows some differences between them. However, there are too many details to write out all the differences at once, so I will continue to update them.</p>

<p>You may find a manual called “Mac OS X Assembler Guide”, but this manual is from 2005 and was written for the transition to Intel. But many things have changed now, and the current <code class="language-plaintext highlighter-rouge">as</code> manual was last updated on April 23, 2020, which is the day the M1 debuted.</p>

<p><img src="/assets/images/50d74259a38846deb9b71de37ffbfa19.png" alt="last update of as manual on April 23, 2020" /></p>

<h2 id="register-expression">Register expression</h2>
<p>In Intel syntax like <code class="language-plaintext highlighter-rouge">masm</code>, registers are written directly, for example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov eax, ebx
</code></pre></div></div>

<p>But in AT&amp;T syntax like <code class="language-plaintext highlighter-rouge">as</code>, in order to not be confused with the identifier (usually it is called as variable), you need to add a percent sign <code class="language-plaintext highlighter-rouge">%</code> in front of the register, and it must be lowercase. as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>movq    %rsp, %rbp
</code></pre></div></div>

<h2 id="command-parameters-the-most-important-difference">Command parameters (the most important difference)</h2>
<p><strong>This is the most important difference!</strong> In <code class="language-plaintext highlighter-rouge">masm</code>, the assembly instruction representing <code class="language-plaintext highlighter-rouge">a=a+b</code> is as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add a, b
</code></pre></div></div>

<p>will add the latter to the former.</p>

<p>But in <code class="language-plaintext highlighter-rouge">as</code>, the assembly instruction indicating <code class="language-plaintext highlighter-rouge">a=a+b</code> is the following structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>add b, a
</code></pre></div></div>

<p>It is executed directly in sequence.</p>

<h2 id="value-of-instruction">Value of instruction</h2>
<p>In <code class="language-plaintext highlighter-rouge">masm</code>, if you want to set a numerical parameter, such as <code class="language-plaintext highlighter-rouge">10</code>, you can write:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov a, 10
</code></pre></div></div>

<p>But in <code class="language-plaintext highlighter-rouge">as</code>, you need to add <code class="language-plaintext highlighter-rouge">$</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov $10, a
</code></pre></div></div>

<p>It is few troublesome, but you can use parentheses to perform some simple calculations, as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov $(2*5), a
</code></pre></div></div>

<h2 id="address-offset">Address offset</h2>
<p>In <code class="language-plaintext highlighter-rouge">masm</code>, if you want to represent an address offset (in many cases, it represents the address of a variable), as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mov eax, [ebp+8]
</code></pre></div></div>

<p>But in <code class="language-plaintext highlighter-rouge">as</code>, its format is <code class="language-plaintext highlighter-rouge">offset (base register, subscript register, scaling)</code>, which looks very complicated, but the most actual situation is simple as follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>movl %edi, -4(%rbp)
</code></pre></div></div>

<h2 id="hexadecimal-notation">Hexadecimal notation</h2>
<p>In <code class="language-plaintext highlighter-rouge">masm</code>, hexadecimal numbers has suffix <code class="language-plaintext highlighter-rouge">H</code> or <code class="language-plaintext highlighter-rouge">h</code>, such as <code class="language-plaintext highlighter-rouge">5c0dH</code>. But in <code class="language-plaintext highlighter-rouge">as</code>, it needs to be written with prefix <code class="language-plaintext highlighter-rouge">0x</code>, such as <code class="language-plaintext highlighter-rouge">0x1234</code>.</p>

        </div>
        <!-- comment by utterances -->
        <script src="https://utteranc.es/client.js"
        repo="ZhongUncle/zhonguncle.github.io"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
        </script>
        <!-- <div class="footer__html">
            <p>
                You can find me in: 
                <a href="https://blog.csdn.net/qq_33919450">CSDN</a>
                <a href="https://github.com/ZhongUncle">GitHub</a>
            </p>
        </div> -->
    </body>
</html>