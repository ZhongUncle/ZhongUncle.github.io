<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='zh-CN'>
        <title>「SwiftUI」推送通知（Notifications）二三事</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>「SwiftUI」推送通知（Notifications）二三事</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="「SwiftUI」推送通知（Notifications）二三事" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="有很多需要推送通知的情况，但是关于SwiftUI的通知推送说的人却不多，这里就说一些相关内容。一方面是为了自己能以后再查阅，另外一方面也是想能帮到有需要的人。" />
<meta property="og:description" content="有很多需要推送通知的情况，但是关于SwiftUI的通知推送说的人却不多，这里就说一些相关内容。一方面是为了自己能以后再查阅，另外一方面也是想能帮到有需要的人。" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/04b02762f73fe5eabfd13a3ba6e5fe18.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/04b02762f73fe5eabfd13a3ba6e5fe18.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-02-21T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="「SwiftUI」推送通知（Notifications）二三事" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-21T00:00:00+08:00","datePublished":"2022-02-21T00:00:00+08:00","description":"有很多需要推送通知的情况，但是关于SwiftUI的通知推送说的人却不多，这里就说一些相关内容。一方面是为了自己能以后再查阅，另外一方面也是想能帮到有需要的人。","headline":"「SwiftUI」推送通知（Notifications）二三事","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/04b02762f73fe5eabfd13a3ba6e5fe18.html"},"url":"https://zhonguncle.github.io/blogs/04b02762f73fe5eabfd13a3ba6e5fe18.html"}</script>
<!-- End Jekyll SEO tag -->

    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swiftui.html" class="headerItem">
            SwiftUI
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/book.html" class="headerItem">
            Book
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>「SwiftUI」推送通知（Notifications）二三事</h1>
            <div class="bloginfo">
                <p class="info">2022-02-21 ｜ <a href="/swiftui.html"> SwiftUI</a> ｜ 1368 字</p>
            </div>
            <!-- excerpt-start -->
<p>有很多需要推送通知的情况，但是关于SwiftUI的通知推送说的人却不多，这里就说一些相关内容。一方面是为了自己能以后再查阅，另外一方面也是想能帮到有需要的人。</p>

<p>本文将讲述：</p>

<ol>
  <li>基础款推送（最常见的通知）</li>
  <li>定时型推送（例如闹铃，纪念日等）</li>
</ol>

<p><strong>在讲述具体操作之前，需要注意一点：通知不能出现在app打开的时候。测试的时候使用模拟器或者实机测试，按完按钮要退出app一下。</strong></p>

<h2 id="基础款推送">基础款推送</h2>
<p>首先来讲述一下最基础的推送，也是最常用的。样式如下：</p>

<p><img src="/assets/images/b98af0a25c2b49049246400ad2045c34.png" alt="最基础的推送" /></p>

<p>代码如下：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">UserNotifications</span>

<span class="c1">//询问用户是否允许该app推送通知</span>
<span class="c1">//由于推送系统中类型蛮多的，可以自己去“设置”中研究一下。这里的.alert表示是否允许弹窗； .sound表示是否允许提示音；.badge表示通知弹窗中的那个小图。</span>
<span class="kd">func</span> <span class="nf">setNotification</span><span class="p">(){</span>
    <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">,</span> <span class="o">.</span><span class="n">badge</span><span class="p">]){</span> <span class="p">(</span><span class="n">granted</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">granted</span> <span class="p">{</span>
            <span class="c1">//用户同意我们推送通知</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"用户同意我们推送通知"</span><span class="p">)</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">//用户不同意</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"用户不同意"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//推送通知</span>
<span class="kd">func</span> <span class="nf">makeNotification</span><span class="p">(){</span>
    <span class="c1">//设置通知的触发器：5秒后触发推送（这种通知推送不能重复）</span>
    <span class="k">let</span> <span class="nv">trigger</span> <span class="o">=</span> <span class="kt">UNTimeIntervalNotificationTrigger</span><span class="p">(</span><span class="nv">timeInterval</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nv">repeats</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
    
    <span class="c1">//通知的内容</span>
    <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="kt">UNMutableNotificationContent</span><span class="p">()</span>
    <span class="n">content</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"通知的标题"</span>
    <span class="n">content</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">"通知的内容"</span>
    <span class="cm">/* 通知提示音，default是“叮～”，就是短信的提示音。还有个defaultCritical，就是一般app推送通知的声音 */</span>
    <span class="n">content</span><span class="o">.</span><span class="n">sound</span> <span class="o">=</span> <span class="kt">UNNotificationSound</span><span class="o">.</span><span class="k">default</span> 
    
    <span class="c1">//完成通知的设置</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">UNNotificationRequest</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"通知名称"</span><span class="p">,</span> <span class="nv">content</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="nv">trigger</span><span class="p">:</span> <span class="n">trigger</span><span class="p">)</span>
    <span class="c1">//添加我们的通知到UNUserNotificationCenter推送的队列里</span>
    <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nv">withCompletionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="nf">setNotification</span><span class="p">()</span>
            <span class="p">})</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"获取推送权限"</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="nf">makeNotification</span><span class="p">()</span>
            <span class="p">})</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"推送通知"</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="定时推送通知">定时推送通知</h2>
<p>有时候闹钟或者To-Do类型的软件需要定时推送通知，样式和实现基础款差不多，只是触发器和提示音部分有点区别（<strong>需要注意这个自定义的提示音不能超过30秒，不然系统会播放默认声音</strong>），代码如下：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="kd">import</span> <span class="kt">UserNotifications</span>

<span class="kd">func</span> <span class="nf">setNotification</span><span class="p">(){</span>
    <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="nf">requestAuthorization</span><span class="p">(</span><span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">alert</span><span class="p">,</span> <span class="o">.</span><span class="n">sound</span><span class="p">,</span> <span class="o">.</span><span class="n">badge</span><span class="p">]){</span> <span class="p">(</span><span class="n">granted</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">if</span> <span class="n">granted</span> <span class="p">{</span>
            <span class="c1">//用户同意我们推送通知</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"用户同意我们推送通知"</span><span class="p">)</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="c1">//用户不同意</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"用户不同意"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//推送通知</span>
<span class="kd">func</span> <span class="nf">makeNotification</span><span class="p">(){</span>
    <span class="c1">//设置通知的时间：推送时间为6点30分</span>
    <span class="k">var</span> <span class="nv">dateComponents</span> <span class="o">=</span> <span class="kt">DateComponents</span><span class="p">()</span>
    <span class="n">dateComponents</span><span class="o">.</span><span class="n">hour</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">dateComponents</span><span class="o">.</span><span class="n">minute</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="c1">//这里最后让repeats为true表示每天的6点30分都会推送通知</span>
    <span class="k">let</span> <span class="nv">trigger</span> <span class="o">=</span> <span class="kt">UNCalendarNotificationTrigger</span><span class="p">(</span><span class="nv">dateMatching</span><span class="p">:</span> <span class="n">dateComponents</span><span class="p">,</span> <span class="nv">repeats</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    
    <span class="c1">//通知的内容</span>
    <span class="k">let</span> <span class="nv">content</span> <span class="o">=</span> <span class="kt">UNMutableNotificationContent</span><span class="p">()</span>
    <span class="n">content</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s">"通知的标题"</span>
    <span class="n">content</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s">"通知的内容"</span>
    <span class="cm">/* 需要注意这个自定义的提示音不能超过30秒，不然系统会播放默认声音 */</span>
    <span class="n">content</span><span class="o">.</span><span class="n">sound</span> <span class="o">=</span> <span class="kt">UNNotificationSound</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="kt">UNNotificationSoundName</span><span class="p">(</span><span class="s">"ring.m4a"</span><span class="p">))</span>
    
    <span class="c1">//完成通知的设置</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">UNNotificationRequest</span><span class="p">(</span><span class="nv">identifier</span><span class="p">:</span> <span class="s">"通知名称"</span><span class="p">,</span> <span class="nv">content</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span> <span class="nv">trigger</span><span class="p">:</span> <span class="n">trigger</span><span class="p">)</span>
    <span class="c1">//添加我们的通知到UNUserNotificationCenter推送的队列里</span>
    <span class="kt">UNUserNotificationCenter</span><span class="o">.</span><span class="nf">current</span><span class="p">()</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="nv">withCompletionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ContentView</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="nf">setNotification</span><span class="p">()</span>
            <span class="p">})</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"获取推送权限"</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{</span>
                <span class="nf">makeNotification</span><span class="p">()</span>
            <span class="p">})</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"推送通知"</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>我们还可以调整通知音量等等属性，自己可以看看哦～</p>

        </div>
    </body>
</html>