<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='zh-CN'>
        <title>关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="前言 之前写了一篇博客来讲如何以 point 和 pixel 两种格式获取 iPhone、iPad 等苹果设备的屏幕尺寸：《SwiftUI——得到屏幕尺寸(bounds和nativeBounds)》，但是苹果最近做了修改，所以写这篇博客来作为补充和改进（原博客也进行了修改）。" />
<meta property="og:description" content="前言 之前写了一篇博客来讲如何以 point 和 pixel 两种格式获取 iPhone、iPad 等苹果设备的屏幕尺寸：《SwiftUI——得到屏幕尺寸(bounds和nativeBounds)》，但是苹果最近做了修改，所以写这篇博客来作为补充和改进（原博客也进行了修改）。" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/798cd052f16bdb59307ef5762928a26d.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/798cd052f16bdb59307ef5762928a26d.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-11-07T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-07T00:00:00+08:00","datePublished":"2022-11-07T00:00:00+08:00","description":"前言 之前写了一篇博客来讲如何以 point 和 pixel 两种格式获取 iPhone、iPad 等苹果设备的屏幕尺寸：《SwiftUI——得到屏幕尺寸(bounds和nativeBounds)》，但是苹果最近做了修改，所以写这篇博客来作为补充和改进（原博客也进行了修改）。","headline":"关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/798cd052f16bdb59307ef5762928a26d.html"},"url":"https://zhonguncle.github.io/blogs/798cd052f16bdb59307ef5762928a26d.html"}</script>
<!-- End Jekyll SEO tag -->

    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/mcu.html" class="headerItem">
            MCU
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>关于UIScreen.main.bounds.height的值发生了变化的原因和解决方案</h1>
            <div class="bloginfo">
                <p class="info">2022-11-07 ｜ <a href="/swift.html"> Swift</a> ｜ 854 字</p>
            </div>
            <!-- excerpt-start -->
<h2 id="前言">前言</h2>
<p>之前写了一篇博客来讲如何以 point 和 pixel 两种格式获取 iPhone、iPad 等苹果设备的屏幕尺寸：<a href="https://blog.csdn.net/qq_33919450/article/details/113743159">《SwiftUI——得到屏幕尺寸(bounds和nativeBounds)》</a>，但是苹果最近做了修改，所以写这篇博客来作为补充和改进（原博客也进行了修改）。</p>

<h2 id="原因及分析">原因及分析</h2>
<p>最近一个开源项目收到一个issue，说有个bug，我想不能够啊。一检查还真有一个bug，研究了一下发现是苹果改了<code class="language-plaintext highlighter-rouge">UIScreen.main.bounds.height</code>的值。但是苹果官方没有提到过这一点，还是说整个屏幕的边界。如下：</p>

<p><img src="/assets/images/ef8efb9e1367425e975ee7a51bbccca2.png" alt="苹果官方对 UIScreen.main.bounds.height 的介绍" /></p>

<p>以 iPhone 11 Pro 为例，<code class="language-plaintext highlighter-rouge">UIScreen.main.bounds.height</code>的值从 1125pt 变成 812pt（举 iPhone 11 Pro 的例子是因为原博客刚好只记录了这个数据），而<code class="language-plaintext highlighter-rouge">UIScreen.main.bounds.width</code>却还是 375pt。这时候可能你会想会不会是减去了上下的 Bar 的安全区域，但是实测不是，就是整个屏幕的高。并且 iPhone 14 Pro 也是同样的情况，所以并不是只属于老设备的。
暂且不知道是 Bug 还是就是硬改了。个人猜测应该是 Bug，原因有 2 点：</p>
<ol>
  <li>原本 iPhone 11 Pro 不论是<code class="language-plaintext highlighter-rouge">bounds</code>还是<code class="language-plaintext highlighter-rouge">nativeBounds</code>的高比宽的比率都是<code class="language-plaintext highlighter-rouge">3</code>。但是现在的<code class="language-plaintext highlighter-rouge">bounds</code>比率是大约<code class="language-plaintext highlighter-rouge">2.1</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">UIScreen.main.bounds.height</code>的值是 812pt，但是 iPhone 11 Pro 原本的<code class="language-plaintext highlighter-rouge">UIScreen.main.nativeBounds.height</code>的值就是 812px，很怀疑是不是数据输入错误了。</li>
</ol>

<p>基于这些怀疑原因，也向苹果进行了报告。</p>

<h2 id="解决方案">解决方案</h2>
<p>这种情况下，如果你使用的比例来控制组件大小，基本上不影响代码。但是如果你使用具体的值来控制组件的大小，或者使用到屏幕的比例了，那么就需要一些解决方案，下面就分别针对二者提出解决方案（如果你有补充欢迎评论哦）：</p>

<ol>
  <li>针对使用具体的值来控制组件的大小的情况，可以使用一个<code class="language-plaintext highlighter-rouge">scale</code>来乘在原本的值上。<code class="language-plaintext highlighter-rouge">scale</code>的表达式是一个简单的数学问题，各位拿草稿纸写一下就能知道。<code class="language-plaintext highlighter-rouge">scale</code>的表达式是<code class="language-plaintext highlighter-rouge">(UIScreen.main.bounds.height/UIScreen.main.bounds.width)/(UIScreen.main.nativeBounds.height/UIScreen.main.nativeBounds.width)</code>。这里带入 iPhone 11 Pro 原本屏幕的高度来验证一下：iPhone 11 Pro 的<code class="language-plaintext highlighter-rouge">scale</code>计算之后得到<code class="language-plaintext highlighter-rouge">2.16533.../3</code>的四舍五入的值<code class="language-plaintext highlighter-rouge">0.72177...</code>，这时候将其乘上原本的高度值<code class="language-plaintext highlighter-rouge">1125</code>就可以得到现在的<code class="language-plaintext highlighter-rouge">812</code>。</li>
  <li>针对使用到比例的代码，要么麻烦一点，对高和宽使用不同的比例；要么使用第一种办法。比如说我做的图片裁剪器，需要使用图片部分 View 的尺寸和比例，但是由于这个地方比例变了，导致出现了 Bug，所以对高和宽使用了不同的比例。</li>
</ol>

<p>这个情况如果后续有变化这里会说明的，希望能帮到有需要的人～</p>

        </div>
    </body>
</html>