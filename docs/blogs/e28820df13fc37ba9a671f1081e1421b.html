<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='en'>
        <title>C语言中函数main的参数argc和argv是什么</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>C语言中函数main的参数argc和argv是什么 | ZhongUncle’s Blog</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="C语言中函数main的参数argc和argv是什么" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="在 Xcode 中新建一个 macOS 平台 Command Line Tool，使用 C 语言，会发现 main 带了两个参数：argc和argv。如下：" />
<meta property="og:description" content="在 Xcode 中新建一个 macOS 平台 Command Line Tool，使用 C 语言，会发现 main 带了两个参数：argc和argv。如下：" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/e28820df13fc37ba9a671f1081e1421b.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/e28820df13fc37ba9a671f1081e1421b.html" />
<meta property="og:site_name" content="ZhongUncle’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-06-17T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="C语言中函数main的参数argc和argv是什么" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-17T00:00:00+08:00","datePublished":"2022-06-17T00:00:00+08:00","description":"在 Xcode 中新建一个 macOS 平台 Command Line Tool，使用 C 语言，会发现 main 带了两个参数：argc和argv。如下：","headline":"C语言中函数main的参数argc和argv是什么","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/e28820df13fc37ba9a671f1081e1421b.html"},"url":"https://zhonguncle.github.io/blogs/e28820df13fc37ba9a671f1081e1421b.html"}</script>
<!-- End Jekyll SEO tag -->

        
        <!-- Microsoft Clarity -->
        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "ix8xlal10a");
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS87H0FDV7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SS87H0FDV7');
        </script>

        
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/mcu.html" class="headerItem">
            MCU
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>C语言中函数main的参数argc和argv是什么</h1>
            <div class="bloginfo">
                <p class="info">2022-06-17 ｜ <a href="/c.html"> C</a> ｜ #Words: 1567 </p>
            </div>
            <!-- excerpt-start -->
<p>在 Xcode 中新建一个 macOS 平台 Command Line Tool，使用 C 语言，会发现 main 带了两个参数：<code class="language-plaintext highlighter-rouge">argc</code>和<code class="language-plaintext highlighter-rouge">argv</code>。如下：</p>

<p><img src="/assets/images/b1c22d7bcb28418fbe83e1642563315b.png" alt="main的两个参数：argc和argv" /></p>

<p><code class="language-plaintext highlighter-rouge">argc</code>被程序唤起的命令行参数的数量，用于统计参数数量。这里会导致你有一个误区，在下面<code class="language-plaintext highlighter-rouge">argv[]</code>部分细说。<strong>需要注意的是，虽然一些程序支持<code class="language-plaintext highlighter-rouge">-abcd</code>这种合在一起的程序，但是 C 会将其认为是一个，需要手动去改。</strong></p>

<p><code class="language-plaintext highlighter-rouge">argv</code>这里需要细致说一下，之前写的太简洁了，评论有人没看懂，有一些底层逻辑需要说明一下。</p>

<p>之前写的版本为：</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">argv</code>是一个指向一个字符串数组的指针，数组包含了参数，每个字符串就是一个参数，最后一个元素为<code class="language-plaintext highlighter-rouge">0</code>。不过一般习惯使用多级指针来操作字符串。</p>
</blockquote>

<p>现在看来确实太简洁了，而且很多人对于数组和指针搞不太清楚，下面详细解释一下，最后进行反省思考。</p>

<p><code class="language-plaintext highlighter-rouge">char *argv[]</code>表示<code class="language-plaintext highlighter-rouge">argv[]</code>是一个存放字符类型元素地址的数组，因为 C 中是有字符串的概念的：将每个字符存放在 char 数组，最后一个元素为<code class="language-plaintext highlighter-rouge">\0</code>表示字符串的结束。<code class="language-plaintext highlighter-rouge">printf(%s)</code>就是输出字符串。并且一般使用<code class="language-plaintext highlighter-rouge">argv</code>指针来访问、处理<code class="language-plaintext highlighter-rouge">argv[]</code>数组的内容。
C语言中，数组就是一个指针加偏移量。所以<code class="language-plaintext highlighter-rouge">argv</code>则是指向一个指针数组<code class="language-plaintext highlighter-rouge">argv[]</code>的指针，不用定义，直接可以用。
在<code class="language-plaintext highlighter-rouge">argv[]</code>数组中存放的的指针指向输入命令的各部分（调用程序、选项、参数）。Shell 中输入的命令通过判断空格进行分割，然后将字符串的头地址放入<code class="language-plaintext highlighter-rouge">argv[]</code>数组中，最后放入一个<code class="language-plaintext highlighter-rouge">0</code>，表示空指针。
比如说如果 Shell 输入为<code class="language-plaintext highlighter-rouge">echo hello, world!</code>，那么<code class="language-plaintext highlighter-rouge">argv[]</code>数组存放的指针有 4 个：</p>
<ol>
  <li>值为<code class="language-plaintext highlighter-rouge">echo\0</code>头地址的指针；</li>
  <li>值为<code class="language-plaintext highlighter-rouge">hello,\0</code>头地址的指针；</li>
  <li>值为<code class="language-plaintext highlighter-rouge">world!\0</code>头地址的指针；</li>
  <li>空指针<code class="language-plaintext highlighter-rouge">0</code>。</li>
</ol>

<p>像这条调用程序后面直接就是参数的很容易判断，直接数组第二个开始即可。
但是很多程序是要判断情况的，也就是选项，开发者应该怎么判断选项和参数呢？
一般习惯使用多级指针来操作字符串。前辈们很聪明，利用这点发明了“UNIX 风格”的命令，比如说<code class="language-plaintext highlighter-rouge">ls -s .</code>这种命令，选项前面加一个横杠<code class="language-plaintext highlighter-rouge">-</code>，这样就可以区分开二者了。
按照 UNIX 的代码惯例，上来直接跳过第一个，然后判断指针指向的字符串第一个字符是不是<code class="language-plaintext highlighter-rouge">-</code>，如果是的，那么进入一个<code class="language-plaintext highlighter-rouge">switch</code>判断，用<code class="language-plaintext highlighter-rouge">case</code>列出多种支持的情况下，应该执行什么代码。例如下面这样就可以判断选项和处理参数:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="n">c</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">*++</span><span class="n">argv</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'-'</span> <span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="o">*++</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">{</span>
		<span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">){</span>
		<span class="k">case</span> <span class="sc">'x'</span><span class="p">:</span>
			<span class="p">...</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="sc">'n'</span><span class="p">:</span>
			<span class="p">...</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printf</span><span class="p">(</span><span class="s">"xxx: illegal opyion %c</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
			<span class="p">...</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>最后逐句思考一下自己之前的版本为什么会有人看不懂。原文截图如下：</p>

<p><img src="/assets/images/05465551a1e74341af3978cc7a0946d5.png" alt="原本本文的内容" /></p>

<p><strong>“<code class="language-plaintext highlighter-rouge">argv</code>是一个指向一个字符串数组的指针，数组包含了参数”：</strong>“argv”这种对于很多人来说就是数组本身。但是一般情况下，如果单独说“argv”，指的是数组的指针。如果指的是数组，需要用“数组 argv”、“argv 数组”、“<code class="language-plaintext highlighter-rouge">argv[]</code>”来表示。因为前面说到过，数组就是利用指针实现的。而且原文我加了代码样式，如果在代码中，<code class="language-plaintext highlighter-rouge">argv</code>就直接表示为指针。并且一般代码中，数组是直接通过指针来使用的。但是在我也问了一下我朋友之后，才知道很多人不清楚这点，以后还是要详细说明一下这种东西。
<strong>“每个字符串就是一个参数，最后一个元素为<code class="language-plaintext highlighter-rouge">0</code>”：</strong> 这句话的问题在于有一点歧义，加上省略了太多东西（看上面的解释也看得出来）。我的意思“程序运行时，会自动将从输入的获取的字符串分割成多个字符串，然后将这些字符串存放在 argv 数组，数组中最后一个元素被存放为空指针<code class="language-plaintext highlighter-rouge">0</code>”。导致歧义的原因是使用了从句。在中文中使用从句确实会导致这个问题，以后注意。
<strong>“不过一般习惯使用多级指针来操作字符串”：</strong> 这个属于我只当笔记记了，这个如果没有看过一些源码的人根本看不懂在说什么东西，心理估计是“你说这个谁懂啊.mp4”。所以以后还是要详细说明一下，当作记录。不然我现在记得什么情况，过了一两年自己也看不懂了。</p>

<p>希望以后博客当中不要再出这些问题了，对于之前打开这篇博客没得到解决的人说一声抱歉。</p>

        </div>
        <!-- comment by utterances -->
        <script src="https://utteranc.es/client.js"
        repo="ZhongUncle/zhonguncle.github.io"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
        </script>
        <!-- comment by utterances -->
        <script src="https://utteranc.es/client.js"
        repo="ZhongUncle/zhonguncle.github.io"
        issue-term="url"
        theme="github-light"
        crossorigin="anonymous"
        async>
        </script>
        <div class="footer__html">
            <p>
                You can find me in: 
                <a href="https://blog.csdn.net/qq_33919450">CSDN</a>
                <a href="https://github.com/ZhongUncle">GitHub</a>
            </p>
        </div>
    </body>
</html>