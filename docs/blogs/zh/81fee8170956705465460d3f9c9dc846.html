<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content=zh-CN>
        <title>如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="下载推流文件其实非常简单，就是通常使用的最简单的命令：" />
<meta property="og:description" content="下载推流文件其实非常简单，就是通常使用的最简单的命令：" />
<link rel="canonical" href="http://localhost:4000/blogs/zh/81fee8170956705465460d3f9c9dc846.html" />
<meta property="og:url" content="http://localhost:4000/blogs/zh/81fee8170956705465460d3f9c9dc846.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-06T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-06-06T00:00:00+08:00","datePublished":"2023-06-06T00:00:00+08:00","description":"下载推流文件其实非常简单，就是通常使用的最简单的命令：","headline":"如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blogs/zh/81fee8170956705465460d3f9c9dc846.html"},"url":"http://localhost:4000/blogs/zh/81fee8170956705465460d3f9c9dc846.html"}</script>
<!-- End Jekyll SEO tag -->

        
        <!-- Microsoft Clarity -->
        <script type="text/javascript">
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "ix8xlal10a");
        </script>

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SS87H0FDV7"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-SS87H0FDV7');
        </script>
    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
</div>
            <h1>如何使用wget下载(录制)流媒体或直播推流文件，以及下载出现“正在把输出重定向至 “wget-log.1””错误该怎么办</h1>
            <div class="bloginfo">
                <p class="info">2023-06-06 ｜ <a href="/research.html"> Research</a> ｜ 1839 字</p>
            </div>
            <!-- excerpt-start -->
<p>下载推流文件其实非常简单，就是通常使用的最简单的命令：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget URL -O 输出文件名
</code></pre></div></div>

<p>这里最好设置一下输出文件名，不然很可能下载的文件名称会很奇怪，导致格式识别错误或者其他问题。</p>

<p>不过，如果你直接使用这个命令很可能会出现一种情况：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget https://xxx.xxx.com/.... -O 1.flv
[2] 60387
[3] 60388
[4] 60389
-bash: 1.flv: command not found
[3]-  Done                    sign=xxxxxxxxxxxxxxxxxxx
[4]+  Done                    abr_pts=-1800
$ 
正在把输出重定向至 “wget-log.1”。
</code></pre></div></div>

<p>这是因为很多推流地址都会有各种参数（query）来表示一些其他信息，比如识别访问的人，如果你删除一些参数，那么会导致链接没有作用。而 URL 参数的分隔符是<code class="language-plaintext highlighter-rouge">&amp;</code>，但是符号<code class="language-plaintext highlighter-rouge">&amp;</code>在<code class="language-plaintext highlighter-rouge">bash</code>等很多 Shell 中表示顺序执行命令的分隔符，所以这导致 Shell 在我们不想的地方分隔了输入命令。</p>

<p>这时候我们可以在<code class="language-plaintext highlighter-rouge">&amp;</code>前面加上反斜杠<code class="language-plaintext highlighter-rouge">\</code>来让 Shell 将其当作简单的字符<code class="language-plaintext highlighter-rouge">&amp;</code>，而不是命令分隔符。但是这样处理之后，其他的一些符号也可能会导致一些问题，所以最简单、高效的办法就是给其加上<code class="language-plaintext highlighter-rouge">"</code>，将其变成字符串。 
因为 Shell 处理字符串是遇到一个<code class="language-plaintext highlighter-rouge">"</code>开始，直到遇到第二个<code class="language-plaintext highlighter-rouge">"</code>在结束识别字符串，这其中的任何符号都会被当成简单的字符来识别。这时输入的命令如下：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ wget "https://xxx.xxx.com/...." -O 1.flv
--2023-06-02 03:57:01--  https://xxx.xxx.com/....
正在解析主机 [隐去的细节]
正在连接 [隐去的细节]|IP|:xxx... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：未指定 [video/格式]
正在保存至: “1.flv”

1.flv                   [    &lt;=&gt;             ]   1.80M   159KB/s               
</code></pre></div></div>

<p>可以看到正常的下载了，下载速度也就是码率，如果下载中断也会保留已下载的部分。</p>

<p>不过下载录制之后，如果遇到无法拖动进度条或者不一定每次播放都成功的这些问题，建议用<code class="language-plaintext highlighter-rouge">ffmpeg</code>等转码工具转一次码，转换时设置的码率稍微比稳定之后的下载速度的 12 倍大一些即可。</p>

<p><strong>2023-06-06 更新：发现可以使用<code class="language-plaintext highlighter-rouge">-c:v copy</code>来获取和应用源视频的设置，包括码率。所以命令可以写作：</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ffmpeg -hwaccel videotoolbox -i in.flv -c:v h264_videotoolbox -c:v copy out.mp4
</code></pre></div></div>

<p>这种使用源设置的方法可以让转码速度提升十倍左右，所以最好使用这种：</p>

<p><img alt="使用源设置的方法可以让转码速度提升十倍左右" src="/assets/images/7bc27a0c3abb47d288ccaee637ab12cf.png" style="box-shadow: 0px 0px 0px 0px" /></p>

<p>转码还有个好处，有些直播推流是下播之后很久才结束，但是视频信息是算了这段时间，但是没有数据。如果你把进度条拖到这个地方，那么视频播放会自动结束。如果转码的话就可以纠正这个问题。</p>

<p>设置码率稍大一些有两个方面的原因：</p>
<ol>
  <li>因为如果格式发生转换，可能会有损耗；</li>
  <li>因为一个视频的码率并不是恒定的，而是在一个范围内波动的。如果你只看了某一瞬间的速度，而这个这个速率与平均码率相差甚远，最高码率可能会超出<code class="language-plaintext highlighter-rouge">ffmpeg</code>允许的偏差，可能会小了。</li>
</ol>

<p>这里可能会有人有疑问说：为什么是 12 倍？不应该是 8 倍吗？因为<code class="language-plaintext highlighter-rouge">1 Byte = 8 bit</code>。</p>

<p>这里之所以是 12 倍是因为下载速度是<code class="language-plaintext highlighter-rouge">这个时段下载的文件大小/这个时段间隔</code>，然后以<code class="language-plaintext highlighter-rouge">KB/s</code>为单位。但是<code class="language-plaintext highlighter-rouge">wget</code>实际刷新速度的间隔并不是 1 秒，加之下载文件并不是一堆流一直下，而是一段一段，这就导致<code class="language-plaintext highlighter-rouge">wget</code>显示的下载速度波动很大，有的时候前后显示差距能有一倍。12 倍是用<code class="language-plaintext highlighter-rouge">1.5x8=12</code>，是一个比较折中的值，如果你不放心可以还大一些。</p>

<p>所以最好还是下载完手算一下，但是有的视频都打不开，也看不到视频信息，那就得按照下载速度推理了。</p>

<p>如果你和我一样觉得：之前不是说视频实际时长可能要比视频信息里的时长要短嘛，那是不是就能抵消掉这个波动呢？</p>

<p>这个我试过，如果将手算 3000K 码率的视频设置为 2000K 码率，那么画质会有比较大的损失（肉眼可见的）。下面是一个对比（左侧为 3000K，右侧为 2000K）：</p>

<p><img src="/assets/images/76d8a89cc2a540e6b0d532fe1c4f88e5.png" alt="左侧为 2000K，右侧为 3000K" /></p>

<p>可以看到 2000K 的头发丝涂抹感严重多了（虽然本来就不是很清晰，因为户外主播码率本来就比较低，但是这样就更模糊了）。更精细的<code class="language-plaintext highlighter-rouge">ffmpeg</code>码率对比可以看我的另外一篇文章<a href="https://blog.csdn.net/qq_33919450/article/details/122053917">《macOS上如何安装（不需要编译安装或者brew）、使用ffmpeg转码的教程，以及如何使用硬件加速》</a>最后的测试对比部分。</p>

<p>有人在手算码率的时候可能会有人担心一点：不少软件是很认真的按照计算机科学中的<code class="language-plaintext highlighter-rouge">1KB = 1000 Byte</code>，<code class="language-plaintext highlighter-rouge">1 KiB = 1024 Byte</code>，因为绝大部分类 Unix 系统都是 1000 进制的，很多人还是在工业环境里干过的。但是有一部分程序员分不清，或者是因为主要开发 Windows上 的程序，就按照 Windows 上的<code class="language-plaintext highlighter-rouge">1KB = 1024 Byte</code>设置的。那么到底按哪个进行计算呢？</p>

<p>我确定过了，<code class="language-plaintext highlighter-rouge">wget</code>和<code class="language-plaintext highlighter-rouge">ffmpeg</code>都是按照计算机科学中的<code class="language-plaintext highlighter-rouge">1KB = 1000 Byte</code>，<code class="language-plaintext highlighter-rouge">1 KiB = 1024 Byte</code>设置的。而且在<code class="language-plaintext highlighter-rouge">K</code>这个级别，二者差别比较小，基本可以忽略。所以如果你使用的是<code class="language-plaintext highlighter-rouge">ffmpeg</code>等比较著名的命令行转码软件，那么不用担心这个问题，按照<code class="language-plaintext highlighter-rouge">1KB = 1000 Byte</code>这种进制进行计算。</p>

<p>但是如果你使用的是 Windows 上的软件，那么很大概率是按照<code class="language-plaintext highlighter-rouge">1KB = 1024 Byte</code>的进制进行计算的。不过有些软件是用的<code class="language-plaintext highlighter-rouge">KiB</code>或者<code class="language-plaintext highlighter-rouge">MiB</code>这种单位的软件，那么就按照<code class="language-plaintext highlighter-rouge">1 KiB = 1024 Byte</code>进行计算就行（比如“B站录播姬”）。</p>

<p>希望能帮到有需要的人～</p>

        </div>
    </body>
</html>