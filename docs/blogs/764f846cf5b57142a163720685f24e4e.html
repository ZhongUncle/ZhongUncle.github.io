<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv='content-language' content='zh-CN'>
        <title>Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="/assets/css/headerstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/blogstyle.css" />
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" />
        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）</title>
<meta name="generator" content="Jekyll v4.3.1" />
<meta property="og:title" content="Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Safari Extension 扩展插件的权限相关的内容大致分为下面几个方面： 用户要掌控扩展（Users are in control） Safari Extension 扩展插件是要在用户控制下的，不能想干嘛就干嘛，因此扩展只有在用户进行互动之后才会运行。在第一次运行之前，扩展图表旁边会有一个提醒，点击会弹出一个标记来帮助指导用户使用。如下：" />
<meta property="og:description" content="Safari Extension 扩展插件的权限相关的内容大致分为下面几个方面： 用户要掌控扩展（Users are in control） Safari Extension 扩展插件是要在用户控制下的，不能想干嘛就干嘛，因此扩展只有在用户进行互动之后才会运行。在第一次运行之前，扩展图表旁边会有一个提醒，点击会弹出一个标记来帮助指导用户使用。如下：" />
<link rel="canonical" href="https://zhonguncle.github.io/blogs/764f846cf5b57142a163720685f24e4e.html" />
<meta property="og:url" content="https://zhonguncle.github.io/blogs/764f846cf5b57142a163720685f24e4e.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-10-25T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-25T00:00:00+08:00","datePublished":"2022-10-25T00:00:00+08:00","description":"Safari Extension 扩展插件的权限相关的内容大致分为下面几个方面： 用户要掌控扩展（Users are in control） Safari Extension 扩展插件是要在用户控制下的，不能想干嘛就干嘛，因此扩展只有在用户进行互动之后才会运行。在第一次运行之前，扩展图表旁边会有一个提醒，点击会弹出一个标记来帮助指导用户使用。如下：","headline":"Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）","mainEntityOfPage":{"@type":"WebPage","@id":"https://zhonguncle.github.io/blogs/764f846cf5b57142a163720685f24e4e.html"},"url":"https://zhonguncle.github.io/blogs/764f846cf5b57142a163720685f24e4e.html"}</script>
<!-- End Jekyll SEO tag -->

    </head>
    <body>
        <div class="stackedit__html">
            <!-- 这个文件里是用来生成导航栏的 -->
<div class="header">
    
        <a href="/index.html" class="headerItem">
            主页
        </a>
    
        <a href="/swift.html" class="headerItem">
            Swift
        </a>
    
        <a href="/unix.html" class="headerItem">
            UNIX
        </a>
    
        <a href="/c.html" class="headerItem">
            C
        </a>
    
        <a href="/assembly.html" class="headerItem">
            Assembly
        </a>
    
        <a href="/go.html" class="headerItem">
            Go
        </a>
    
        <a href="/plan9.html" class="headerItem">
            Plan 9
        </a>
    
        <a href="/web.html" class="headerItem">
            Web
        </a>
    
        <a href="/research.html" class="headerItem">
            Research
        </a>
    
        <a href="/non-tech.html" class="headerItem">
            Non-Tech
        </a>
    
</div>
            <h1>Safari Extension 扩展插件中关于权限的二三事（例如设置权限、权限类型等）</h1>
            <div class="bloginfo">
                <p class="info">2022-10-25 ｜ <a href="/swift.html"> Swift</a> ｜ 1423 字</p>
            </div>
            <!-- excerpt-start -->
<p>Safari Extension 扩展插件的权限相关的内容大致分为下面几个方面：</p>
<h3 id="用户要掌控扩展users-are-in-control">用户要掌控扩展（Users are in control）</h3>
<p>Safari Extension 扩展插件是要在用户控制下的，不能想干嘛就干嘛，因此扩展只有在用户进行互动之后才会运行。在第一次运行之前，扩展图表旁边会有一个提醒，点击会弹出一个标记来帮助指导用户使用。如下：</p>

<p><img src="/assets/images/49da440dcaf04105aecb069ccf3b6c03.png" alt="在第一次运行之前，扩展图表旁边会有一个提醒，点击会弹出一个标记来帮助指导用户使用" /></p>

<p>激活后的扩展图标会变成蓝色的。</p>

<p><img src="/assets/images/79b32688277043f9bfa2d0251ad229ba.png" alt="激活后的扩展图标会变成蓝色的" /></p>

<h3 id="可以根据各个网站来授予权限permissions-are-per-website">可以根据各个网站来授予权限（Permissions are per-website）</h3>
<p>Safari Extension 扩展插件的权限是可以针对不同网站来授予的，这样用户就可以自行决定在一些网站中才能使用扩展，或者在一些网站中不使用扩展。（开发者也可以针对不同的网站来设置权限，这里不赘述，下一节中细说）
点击下图红色方框中的“编辑网站”按钮，就可以看到已配置该扩展的网站和权限。（<strong>这里建议各位读者尝试将默认生成项目中的<code class="language-plaintext highlighter-rouge">example.com</code>改成<code class="language-plaintext highlighter-rouge">*</code>来匹配所有网站，然后点击激活扩展之后，再访问几个网站看看下面的窗口会变成什么样，这样就更好理解了</strong>）</p>

<p><img alt="编辑允许运行的网站" src="/assets/images/295c2292bc66490a901f49fc4ab08594.png" style="box-shadow: 0px 0px 0px 0px" /></p>

<p><img alt="查看允许运行的网站" src="/assets/images/73a0543bbcb343c09c2ff43fe97b594a.png" style="box-shadow: 0px 0px 0px 0px" /></p>

<h3 id="四种权限类型">四种权限类型</h3>
<p>开发者设置或调整这些权限类型时，需要在项目的 manifest.json 文件中进行相关操作。</p>
<h4 id="脚本插入权限script-injection-permission">脚本插入权限（Script injection Permission）</h4>
<p>脚本插入权限运行对用户当前浏览的界面插入 JavaScript 脚本和 CSS 样式表。
json 中的格式如下：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">//脚本插入权限</span><span class="w">
</span><span class="nl">"content_scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
	</span><span class="nl">"js"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"content.js"</span><span class="w"> </span><span class="p">],</span><span class="w">
	</span><span class="nl">"css"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"content.css"</span><span class="w"> </span><span class="p">],</span><span class="w">
	</span><span class="nl">"matches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"*://example.com/*"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}]</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p>其中：</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">"js"</code>表示如果当前页面在匹配的网站，那么插入 content.js 脚本。</li>
  <li><code class="language-plaintext highlighter-rouge">"css"</code>表示如果当前页面在匹配的网站，那么插入 content.css 样式表。</li>
  <li><code class="language-plaintext highlighter-rouge">"matches"</code>表示匹配域名的正则表达式，通过正则表达式来判断当前页面是否在允许插入脚本的域名中。</li>
</ul>

<p>如果当前页面在匹配的域名中，那么用户就可以点击启用脚本来插入脚本或样式表了。</p>

<h4 id="隐式权限implicit-permission">隐式权限（Implicit Permission）</h4>
<p>在默认生成的扩展项目的 manifest.json 文件中，可以看到这么一段代码（因为放在最后所以实际上是没有最后的逗号<code class="language-plaintext highlighter-rouge">,</code>的）：</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"permissions"</span><span class="p">:</span> <span class="p">[</span> <span class="p">],</span>
</code></pre></div></div>

<p>方括号<code class="language-plaintext highlighter-rouge">[ ]</code>中就是用于填写隐式权限的。下面举个例子：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
	</span><span class="err">//第一部分</span><span class="w">
	</span><span class="s2">"alarms"</span><span class="p">,</span><span class="s2">"clipboardWrite"</span><span class="p">,</span><span class="w"> </span><span class="s2">"menus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"nativeMessaging"</span><span class="p">,</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">,</span><span class="w">

	</span><span class="err">//第二部分</span><span class="w">
	</span><span class="s2">"cookies"</span><span class="p">,</span><span class="w"> </span><span class="s2">"tabs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"webNavigation"</span><span class="w">
</span><span class="p">]</span><span class="err">,</span><span class="w">
</span></code></pre></div></div>

<p>第一部分是非敏感的权限，它们不需要额外的特权；第二部分是敏感的权限，因为它们具有网站标识数据，例如 Cookies。</p>

<p><strong>隐式权限的原理是</strong>，当你访问 API 的时候，它会等待回调和数据，<strong>用户和扩展交互之后</strong>会看到询问权限的提示（也就是用户来提出权限申请）。在用户允许之后，回调会被执行，数据也会返回，所有允许的操作都会立刻执行。</p>

<h4 id="显式权限explicit-permission">显式权限（Explicit Permission）</h4>
<p>显式权限之所以称之为“显式”是因为扩展本身会索取权限，并且索取权限的提示永远以模态形式，而不会添加任何标记。这是因为索取权限的是扩展本身，而不是用户。</p>

<p>这个权限需要在 background.js 文件中写入，如下：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">permissionsToRequest</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">permissions</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">tabs</span><span class="dl">"</span><span class="p">],</span>
	<span class="na">origins</span><span class="p">:</span> <span class="p">[</span><span class="dl">"</span><span class="s2">*://example.com/*</span><span class="dl">"</span><span class="p">]</span>
<span class="p">}</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">permissions</span><span class="p">.</span><span class="nx">request</span><span class="p">([</span><span class="dl">"</span><span class="s2">permissionsToRequest</span><span class="dl">"</span><span class="p">]);</span>
</code></pre></div></div>

<h4 id="活跃标签页权限active-tab-permission">活跃标签页权限（Active Tab Permission）</h4>
<p>该权限填写在<code class="language-plaintext highlighter-rouge">"permissions": [ ]</code>中，如下：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> 
	</span><span class="s2">"activeTab"</span><span class="w">
</span><span class="p">]</span><span class="err">,</span><span class="w">

</span></code></pre></div></div>

<p>这是一种特殊情形，如果此时您不想显示提醒，那么就可以使用活跃标签页。用户需要通过工具栏（Mac 上可以使用快捷键或菜单）来与扩展交互。如果启用该权限，那么将会为当前标签页的域名授予标签页权限。</p>

        </div>
    </body>
</html>