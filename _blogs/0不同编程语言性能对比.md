---
layout: article
category: Research
date: 2023-03-31
title: 不同编程语言性能对比
---
<!-- excerpt-start -->
突然好奇不同语言之间的性能对比，比较很多地方都在强调不同语言之间的性能区别，但是自己又没有实际感受，所以就想做一些实验来看看实际情况。当然这个实验是没法一次做完的，毕竟我并不能一次性列出自己想做的所有测试项目，而且可能还会有新的语言加入，甚至是加入汇编语言作为基准，以及脚本语言作为对比。所以这可能是一个时间跨度很长的项目。

## 关于数据和测试的一些情况
### 各编译器或框架版本

|语言|编译器版本|
|-|-|
|C/C++|Apple clang version 14.0.0 (clang-1400.0.29.102)|
|Java|javac 19.0.1|
|Go|go version go1.20.2 darwin/amd64|
|Python3|Python 3.9.10|
|Swift|Apple Swift version 5.7 (swiftlang-5.7.0.127.4 clang-1400.0.29.50)|

### 时间之和不对
记录时间是使用`time`命令统计其运行时间。由于一些程序运行时间太短，可以跑三次及以上，取中间值或者最常出现的值。**由于存在四舍五入，所以会存在简单将用户时长和系统时长加起来不等于总时长的情况。**

### 第一次运行时间显示不正确
有些语言的测试结果有一个很有意思的地方，不清楚是什么原因，第一次记录的总时长会很大（不是误差的程度），但是用户时长和系统时长都是正常的。所以忽略第一次运行的结果。

### Swift使用调用函数的方式
Swift 使用调用函数的方式，因为是否使用函数来处理会导致性能有可能十倍的差距，如下是轻度循环测试的两种情况下的结果（运行了十几次，确保不是误差导致的）：

|Swift是否使用函数|总时长（秒）|用户时长（秒）|系统时长（秒）|
|-|-|-|-|
|不使用函数|0.286|0.283|0.001|
|使用函数|0.029|0.026|0.001|

## 循环测试
一般来说，循环语句是由跳转指令（一般是带判断的跳转指令）和一些其他指令构成的。而且像`while`、`for`这样的循环语句的使用率也很高，也是很多代码运行长时间运行的原因之一。

### 轻度循环测试
第一个项目是对不同编程语言进行1000000（一千万）次`while`循环和自增，并且打印出最后的和。由于每次循环的操作简单，就算是循环了一千万次，但还是一种轻度测试。

这里之所以 Swift 使用`while`循环,是因为 Swift 使用的 For-In 在简单的循环上要比 While 慢得多，因为设计目的是为了遍历数组之类的数据结构。

|语言|总时长（秒）|用户时长（秒）|系统时长（秒）|
|-|-|-|-|
|C/C++|0.020|0.018|0.001|
|Java|0.053|0.031|0.021|
|Go|0.007|0.004|0.002|
|Python3|0.837|0.827|0.009|
|Swift（不使用函数）|0.286|0.283|0.001|
|Swift（使用函数）|0.029|0.026|0.001|

可以看到所有编程语言都大幅领先脚本语言。在这次测试中，Go 语言甚至比 C/C++ 还快三倍（加大循环次数，比例还是三倍）。这个速度真的是非常之快了

下面是各语言代码：
C/C++：

```cpp
#include <iostream>

int main() {
	int j = 0;
    for (int i=0; i<10000000; i++) {
        j++;
    }
    
	std::cout<<j<<std::endl;
    
	return 0;
}
```

Java：

```java
public class test {
    public static void main(String[] argv) {
        int j = 0;
        for (int i=0; i<10000000; i++) {
            j++;
        }
        System.out.println(j);
    }
}
```

Go：

```java
package main

import "fmt"

func main() {
	j := 0
	for i := 0; i < 10000000; i++ {
		j++
	}
	
	fmt.Println(j)
}
```

Python：

```python
#!/usr/bin/python3
 
j = 0

for number in range(0, 10000000):
    j=j+1

print(j)
```

Swift:

```swift
func loop() {
    var i = 0
    var j = 0

    while i < 10000000 {
        i += 1
        j += 1
    }

    print(j)
}

loop()

```


### 中度循环测试
